function toggleBox(e){e.hasClass("opened")?(e.removeClass("opened"),e.addClass("closed")):(e.removeClass("closed"),e.addClass("opened"))}function save_comment(e){var t=jQuery;open_loading(DEFAULT_LOADING_MESSAGE);var o=t(e),n=o.parents("form"),r=(o.parents(".post_comment_box"),o.parents(".comments")),a=o.parents(".page-comment-form");o.addClass("comment-button-loading"),t.post(n.attr("action"),n.serialize(),function(e){null==e.render_target?(n.find("input[type='text']").add("textarea").each(function(){this.value=""}),a.find(".errorExplanation").remove()):"form"==e.render_target?(t.scrollTo(a),a.html(e.html),t(".display-comment-form").hide()):t("#"+e.render_target).size()>0?(t("#"+e.render_target).replaceWith(e.html),t("#"+e.render_target).effect("highlight",{},3e3),noosfero.modal.close(),increment_comment_count(r)):(r.find(".article-comments-list").append(e.html),n.find("input[type='text']").add("textarea").each(function(){this.value=""}),a.find(".errorExplanation").remove(),noosfero.modal.close(),increment_comment_count(r)),jQuery("#recaptcha_response_field").val()&&Recaptcha.reload(),null!=e.msg&&display_notice(e.msg),close_loading(),toggleBox(o.closest(".post_comment_box")),show_display_comment_button(),o.removeClass("comment-button-loading"),o.enable()},"json")}function increment_comment_count(e){e.find(".comment-count").add("#article-header .comment-count").each(function(){var e=parseInt(jQuery(this).html());update_comment_count(jQuery(this),e+1)})}function show_display_comment_button(){0==jQuery(".post_comment_box.opened").length&&jQuery(".display-comment-form").show()}jQuery(".display-comment-form").unbind(),jQuery(".display-comment-form").click(function(){var e=jQuery(this);return toggleBox(e.parents(".post_comment_box")),jQuery(e).hide(),e.closest(".page-comment-form").find('input[type="text"]:visible,textarea').first().focus(),!1}),jQuery("#cancel-comment").die(),jQuery("#cancel-comment").live("click",function(){var e=jQuery(this);toggleBox(e.parents(".post_comment_box")),show_display_comment_button();var t=e.parents(".page-comment-form");return t.find(".errorExplanation").remove(),!1});