!function(t,i){"use strict";var e=document.createElement("video"),o={webm:!!e.canPlayType("video/webm").replace(/no/,""),ogg:!!e.canPlayType("video/ogg").replace(/no/,""),mp4:!!e.canPlayType("video/mp4").replace(/no/,"")};t.VideoChannel=function(t){this.baseEl=t,i(".video-player",this.baseEl)[0]&&(this.player=new NoosferoVideoPlayer(this.baseEl,this),this.init())},VideoChannel.prototype.init=function(){var t=this;i(".video-list-item",this.baseEl).each(function(i,e){t.initItem(e)}),i(".video-list li",this.baseEl)[0]?this.updatePlayer(i("li",this.baseEl).first()):(log.info("there is no playable video yet."),i(".video-player",this.baseEl).hide())},VideoChannel.prototype.initItem=function(t){var e=this;i(t).click(function(){e.updatePlayer(t,!0)});var o=i("a",t)[0];o.onclick=function(){return!1},o.nextFrame=VideoChannel.nextFrame,o.frameFade||(o.frameFade=i('<div class="frame-fade"></div>').prependTo(o)[0]),o.frameFade.style.backgroundImage=o.style.backgroundImage,o.addEventListener("animationend",function(){o.nextFrame()},!1),o.addEventListener("webkitAnimationEnd",function(){o.nextFrame()},!1),o.nextFrame()},VideoChannel.nextFrame=function(t){if(t)this.frameFade.style.animationDuration="1s",this.frameFade.style.animationName="fadein",this.frameFade.style.MozAnimationDuration="1s",this.frameFade.style.MozAnimationName="fadein",this.frameFade.style.webkitAnimationDuration="1s",this.frameFade.style.webkitAnimationName="'fadein'";else{this.frameFade.style.opacity=0,this.frameFade.style.animationName="",this.frameFade.style.MozAnimationName="",this.frameFade.style.webkitAnimationName="",this.bgYPos||(this.bgYPos=0),this.style.backgroundPosition="50% "+-120*this.bgYPos++ +"px",this.bgYPos>5&&(this.bgYPos=0),this.frameFade.style.backgroundPosition="50% "+-120*this.bgYPos+"px";var i=this;setTimeout(function(){i.nextFrame(!0)},10)}},VideoChannel.prototype.updatePlayer=function(t,e){var o=i("a",t)[0].getAttribute("data-webversions");this.player.videoList=JSON.parse(o),this.player.selectWebVersion(),this.player.update(this.getItemData(t),e)},VideoChannel.prototype.getItemData=function(t){var e=i("a",t)[0],o=(i("span",t),{});return o.pageURL=e.href,o.videoURL=e.getAttribute("data-download"),o.posterURL=e.getAttribute("data-poster"),o.title=i(e).text(),o.abstract=i(".abstract",t)[0].innerHTML,o.tags=i(".vli-data-tags > div",t)[0].innerHTML,o},t.NoosferoVideoPlayer=function(t,e){if(this.channel=e,this.divBase=i(".video-player",t)[0],this.divBase){this.info={title:i("h2",this.divBase)[0],quality:i(".quality ul",this.divBase)[0],tags:i(".tags div",this.divBase)[0],"abstract":i(".abstract div",this.divBase)[0],videoCtrl:i(".video-ctrl",this.divBase)[0],downloadBt:i(".download-bt",this.divBase).button({icons:{primary:"ui-icon-circle-arrow-s"}})[0]},this.videoBox=i(".video-box",this.divBase)[0];var o=this;this.zoomBt=i('<button class="zoom">Zoom</button>').button({icons:{primary:"ui-icon-zoomin"},text:!1}).click(function(){o.toggleZoom()}).appendTo(this.info.videoCtrl),this.zoomBt[0].title="Zoom in",this.videoEl=i("video",this.divBase)[0]}},NoosferoVideoPlayer.prototype.update=function(t,e){this.info.title.innerHTML=t.title,this.videoEl.src=t.videoURL,this.videoEl.autoplay=e,this.poster=t.posterURL,this.videoEl.load();var o=t.tags||'<span class="empty">None</span>';i(this.info.tags).empty().append(o);var a=t.abstract||'<span class="empty">None</span>';i(this.info.abstract).empty().append(a),this.info.downloadBt.href=t.videoURL},NoosferoVideoPlayer.prototype.updateQualityOpts=function(t){var e=this;i(this.info.quality).empty();for(var o in this.videoList[t]){var a=this.videoList[t][o];if(log.info("Quality option:",a),"done"==a.status){var s=a.size_name;this.channel||(s=a.size.w+"x"+a.size.h+" <small>"+a.vbrate+" KB/s</small>");var n=i('<li data-path="'+a.path+'">'+s+"</li>").button({icons:{primary:"ui-icon-video"}}).click(function(){e.load(this.video,!0)}).appendTo(this.info.quality)[0];n.video=a,a.qualityBt=n}}},NoosferoVideoPlayer.prototype.load=function(t,e){this.currentVideo&&i(this.currentVideo.qualityBt).button().button("enable"),i(t.qualityBt).button("disable"),this.currentVideo=t,this.videoEl.src=t.path,this.videoEl.preload="metadata",e&&i.cookie("video_quality",t.size_name,{path:"/"}),"true"==i.cookie("video_zoom")?this.zoomIn():this.zoomOut()},NoosferoVideoPlayer.prototype.toggleZoom=function(){i(this.divBase).hasClass("zoom-in")?this.zoomOut():this.zoomIn()},NoosferoVideoPlayer.prototype.zoomIn=function(){i.cookie("video_zoom","true",{path:"/"}),i(this.divBase).removeClass("zoom-out").addClass("zoom-in")},NoosferoVideoPlayer.prototype.zoomOut=function(){i.cookie("video_zoom","false",{path:"/"}),i(this.divBase).removeClass("zoom-in").addClass("zoom-out")},NoosferoVideoPlayer.prototype.selectWebVersion=function(){var t=null,e=this,a=i.cookie("video_quality")||"tiny",s="tiny"==a?"nice":"tiny",n=o.webm?"WEBM":o.ogg?"OGV":"MP4";((t=this.getVideoFromList(n,a))||(t=this.getVideoFromList(n,s)))&&(this.updateQualityOpts(t.type),setTimeout(function(){e.load(t)},10))},NoosferoVideoPlayer.prototype.getVideoFromList=function(t,i){if(log.info("Trying to getVideoFromList",t,i),!this.videoList&&!this.videoList)return log.info("The video list is empty"),null;"nice"!=i.toLowerCase()&&(i="tiny");var e=this.videoList[t][i];return log.info("getVideoFromList find:",e),e&&"done"==e.status?(log.info("getVideoFromList success"),e):(log.info("getVideoFromList fail"),null)}}(window,jQuery);