<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="pt" lang="pt" class="controller-content_viewer action-content_viewer-view_page template-default profile-type-is-person profile-name-is-andre-ferraro theme-sl-default">
  <head>
    <title>Blog - Ferraro</title>
    <link rel="alternate" type="application/rss+xml" title="Blog" href="http://softwarelivre.org/andre-ferraro/blog/feed" />
    <!--<meta http-equiv="refresh" content="1"/>-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    

      <meta name="description" content="Software Livre Brasil" />

    <!-- site root -->
    <meta property="noosfero:root" content=""/>

    <link rel="shortcut icon" href="/designs/themes/sl-default/favicon.ico" type="image/x-icon" />
    

    <script src="/assets/application-1c0930e8f260aafbc74c4fad04079409.js"></script>

  
  
<script src="/javascripts/plugins/pg_search/search.js"></script>
<script src="/javascripts/plugins/pg_search/profile_search_block.js"></script>
<script src="/assets/plugins/require_auth_to_comment/hide_comment_form-c3a3727ea301c62930e11aab20ae74d4.js"></script>
<script src="/assets/plugins/require_auth_to_comment/jquery.livequery.min-d1fe96eb7788079f6e550db2b6610365.js"></script>
<script src="/assets/plugins/orders/javascripts/locale-17eaae2c136082dab9da1d91648b6a7e.js"></script>
<script src="/assets/plugins/orders/javascripts/toggle_edit-f9da47bc0223fac8e5e5174c6ea24413.js"></script>
<script src="/assets/plugins/orders/javascripts/sortable-table-ba58eb377fc175eb1e374be63d5454a3.js"></script>
<script src="/assets/plugins/orders/javascripts/help-14515dc2f741beaa4b3d121df366af0d.js"></script>
<script src="/assets/plugins/orders/javascripts/orders-560e35746985dc40b97851b13705cb26.js"></script>
<script src="/assets/plugins/html5_video/video-channel-6aca45f93220c0910d8273dd2368004e.js"></script>
<script src="/assets/plugins/suppliers/javascripts/locale-17eaae2c136082dab9da1d91648b6a7e.js"></script>
<script src="/assets/plugins/suppliers/javascripts/toggle_edit-f9da47bc0223fac8e5e5174c6ea24413.js"></script>
<script src="/assets/plugins/suppliers/javascripts/sortable-table-ba58eb377fc175eb1e374be63d5454a3.js"></script>
<script src="/assets/plugins/suppliers/javascripts/suppliers-35473b9ebd4b9e65027e1bafa94dfdcd.js"></script>
<script src="/assets/plugins/event/event-b1013aca7ce3cf0d4d5e6e10dc1f05b2.js"></script>
<script src="/assets/plugins/display_content/javascripts/jstree/_lib/jquery-1.8.3-09dfd3b315fe6b24fbc309e36f5d70c3.js"></script>
<script src="/assets/plugins/display_content/javascripts/jstree/jquery.jstree-563d09f7e7938a8a2f4207bfe6d48dd3.js"></script>
<script src="/assets/plugins/container_block/container_block-7eae56f79aa8da8b64941d18d2972c7b.js"></script>
<script src="/assets/plugins/delivery/javascripts/delivery-da5b2dac737692db94d5bdc654586171.js"></script>
<script src="/assets/plugins/products/javascripts/products-a4c860d8dbebe524d554f0b5564e0428.js"></script><script src="/designs/themes/sl-default/theme.js"></script><script>
//<![CDATA[
render_all_jquery_ui_widgets()
//]]>
</script>
    <link rel="stylesheet" media="screen" href="/assets/application-e0072ababb97032fa1a5d95fa09d897c.css" />
<link rel="stylesheet" media="screen" href="/designs/templates/default/stylesheets/style.css" />
<link rel="stylesheet" media="screen" href="/assets/designs/icons/default/style-b3a500c1e17f47b010a70fdb0103012e.css" />
<link rel="stylesheet" media="screen" href="/assets/designs/icons/pidgin/style-138f7bb59f9d26296632e82eae162877.css" />
<link rel="stylesheet" media="screen" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/people_block/style-c340afe175b0045c7f8669073a428a1c.css" />
<link rel="stylesheet" media="screen" href="/stylesheets/plugins/pg_search/style.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/recent_content/style-e0d5f807f7056b173f6cf113c840ddc0.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/custom_forms/style-7870704d75309d55ffcaa827c59baa18.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/work_assignment/style-526deb629c3d9e7736f049b99c72a50a.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/require_auth_to_comment/style-66a0efab118159977ca0194806ef4bec.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/orders/style-feb7767bc71e62563ccab53642a6e4c2.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/html5_video/style-8f2b70d373ff7ec22b404d91b1b6f211.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/suppliers/style-64c71b3cd22994ada93abd55c70ea1ce.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/gallery_block/style-4547593291c3fca2ad50216cbb3dfdc9.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/send_email/style-976778195cb106e52b31d57242cdc01c.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/event/style-8f5f6a9b5a7724dbc4977d11c2e4321c.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/display_content/style-cf10f47511255685485ac51859c22a29.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/container_block/style-dd17a810971259abe7c31678e9d9c132.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/video/style-68d51000d73adab06c1dcd036011138d.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/delivery/style-aeef749320f3cdff642340f047806f9b.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/sub_organizations/style-88810bb91c1c70f63817f6f03295fd92.css" />
<link rel="stylesheet" media="screen" href="/assets/plugins/products/style-3147a337d78ccc54df05870c504166fd.css" />
<link rel="stylesheet" media="screen" href="/designs/themes/sl-default/global.css" />
<link rel="stylesheet" media="screen" href="/assets/designs/themes/sl-default/style-f317a60b59d0ee3e8048cb6eba54b282.css" />

    
    

    <script type="text/javascript">
      DEFAULT_LOADING_MESSAGE = 'loading...';
      PERMANENT_NOTIFICATIONS = false;
      noosfero.profile = "andre-ferraro"
    </script>

      
<script src="/assets/tinymce/js/tinymce/tinymce-666c93593f34cd23b1f1e9177ab27cae.js"></script><script src="/assets/tinymce/js/tinymce/jquery.tinymce.min-33361c760deadb5b77610a12911056f2.js"></script><script src="/assets/tinymce-4df3fc98953118b704cdb7a023aafdc2.js"></script>
<script type="text/javascript">
tinymce.create('tinymce.plugins.MacrosPlugin', {
  createControl: function(n, cm) {
    switch (n) {
       case 'macros':
    }
    return null;
  }
});

function tinymce_macros_setup(editor) {
}

// Register plugin with a short name
tinymce.PluginManager.add('macrosPlugin', tinymce.plugins.MacrosPlugin);

jQuery(document).ready(function () {
  noosfero.tinymce.init({"document_base_url":"http://softwarelivre.org","content_css":"/stylesheets/tinymce.css,","plugins":["compat3x","advlist","autolink","lists","link","image","charmap","print","preview","hr","anchor","pagebreak","searchreplace","wordcount","visualblocks","visualchars","code","fullscreen","insertdatetime","media","nonbreaking","save","table","contextmenu","directionality","emoticons","template","paste","textcolor","colorpicker","textpattern"],"image_advtab":true,"language":"pt_BR","selector":".tiny_mce","toolbar1":"fullscreen | insertfile undo redo | copy paste | bold italic underline | styleselect fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image","menubar":"edit insert view tools","toolbar2":"print preview code media | table | macros","macros_setup":[]})
  noosfero.tinymce.init({"document_base_url":"http://softwarelivre.org","content_css":"/stylesheets/tinymce.css,","plugins":["compat3x","advlist","autolink","lists","link","image","charmap","print","preview","hr","anchor","pagebreak","searchreplace","wordcount","visualblocks","visualchars","code","fullscreen","insertdatetime","media","nonbreaking","save","table","contextmenu","directionality","emoticons","template","paste","textcolor","colorpicker","textpattern"],"image_advtab":true,"language":"pt_BR","selector":".tiny_mce_simple","toolbar1":"fullscreen | insertfile undo redo | copy paste | bold italic underline | styleselect fontsizeselect | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image","menubar":false,"toolbar2":null,"macros_setup":[]})
  noosfero.tinymce.init({"document_base_url":"http://softwarelivre.org","content_css":"/stylesheets/tinymce.css,","plugins":["compat3x","advlist","autolink","lists","link","image","charmap","print","preview","hr","anchor","pagebreak","searchreplace","wordcount","visualblocks","visualchars","code","fullscreen","insertdatetime","media","nonbreaking","save","table","contextmenu","directionality","emoticons","template","paste","textcolor","colorpicker","textpattern"],"image_advtab":true,"language":"pt_BR","selector":".tiny_mce_restricted","toolbar1":"bold italic underline | link","menubar":false,"toolbar2":null,"macros_setup":[]})
});
</script>


  </head>
  <body class="controller-content_viewer action-content_viewer-view_page template-default">
    <a href="#content" id="link-go-content"><span>Ir para o conteúdo</span></a>
    
    <div id="global-header">
      <!-- div class='supportbanner'>
  <div class='content'>
    <div class='banner-title'>Campanha de doação 2016</div>
    <div class='banner-subtitle'>Ajude a <span class='asl'>ASL.Org</span> a realizar o <span class='fisl17'>FISL17</span>!</div>
    <p>Ajude a Associação Software Livre.Org a continuar seu trabalho de 12 anos em prol do desenvolvimento e disseminação do Software Livre. Faça uma doação e ganhe um ingresso cortesia para o <span class='fisl17'>FISL17</span> e uma camiseta oficial do evento.</p>
  </div>
  <div class='footer-links'>
    <a class='logo-fisl17' href='http://fisl.org.br' target='_blank'><span>fisl17</span></a>
    <a class='logo-asl' href='http://asl.org' target='_blank'><span>ASL.org</span></a>
    <a class='iot-fisl' href='http://segue.fisl17.softwarelivre.org' target='_blank'><span>Contribua para o fisl17</span></a>
  </div>
</div -->

    </div>

    <div id="wrap-1">
      <div id="theme-header">
        <div id="top">
  <ul id="top-menu">
    <li><a href="/"><span>Início</span></a></li>
    <li><a id="submenu-people" href="/search/people"><span class="icon-menu-people">Pessoas</span></a><a class="up menu-submenu-trigger" id="submenu-people-trigger" onclick="toggleSubmenu(this, '', {&quot;Mais recentes&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/people?filter=more_recent&quot;},&quot;Mais ativas&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/people?filter=more_active&quot;},&quot;Mais populares&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/people?filter=more_popular&quot;}}); return false" href="#"><span>Menu de pessoas</span></a></li>
    <li><a id="submenu-communities" href="/search/communities"><span class="icon-menu-community">Comunidades</span></a><a class="up menu-submenu-trigger" id="submenu-communities-trigger" onclick="toggleSubmenu(this, '', {&quot;Mais recentes&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/communities?filter=more_recent&quot;},&quot;Mais ativas&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/communities?filter=more_active&quot;},&quot;Mais populares&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/search/communities?filter=more_popular&quot;}}); return false" href="#"><span>Menu de comunidades</span></a></li>
    <li><a href="/profile/portal/events" id="submenu-events"><span class='icon-menu-events'>Eventos</span></a></li>
    <li><a href="/doc"><span>Manual</span></a></li>
    <li><a href="/portal/quem-somos" id="submenu-about"><span>Sobre</span></a></li>
  </ul>
</div>

      </div>
      <div id="wrap-2">
        <div id="user">
    <span class='not-logged-in'>
      <span class='login'><a id="link_login" onclick="return noosfero.modal.inline(&#39;#inlineLoginBox&#39;)" class="" href="/account/login"><i class="icon-menu-login"></i><strong>Entrar</strong></a></span>

      <div id='inlineLoginBox' style='display: none;'>
        <div class="login-box">

<h2>Entrar</h2>




<form action="/account/login" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="A9ZvR+ZjmfMYi5qM/29ppbbcQPYMj8ePQuAEDWjTzmSevt9GlDibEPeQbxJ57xPG+U2KNQQDAN0fbD0JN1hotg==" />

     <div class="formfieldline"><label class="formlabel" for="main_user_login">Nome de usuário / E-mail</label><div class="formfield type-text"><input id="main_user_login" onchange="this.value = convToValidLogin( this.value )" type="text" name="user[login]" /></div></div>

     <div class="formfieldline"><label class="formlabel" for="user_password">senha</label><div class="formfield type-password"><input type="password" name="user[password]" id="user_password" /></div></div>

     <div class='checkbox'>
       <label>
         <input type="checkbox" name="remember_me" id="remember_me" value="1" checked="checked" />
         Mantenha-me logado
       </label>
     </div>

     

     <div class=" button-bar">
       <input type="submit" name="commit" value="Entrar" class="button with-text icon-login submit" />
         <a class="button icon-close with-text modal-toggle modal-close" rel="deactivate" title="Cancelar" href="#">&nbsp;<span>Cancelar</span></a>
<br style="clear: left;" /></div>
</form>
<div class=" button-bar">
    <a class="button icon-add with-text" title="Novo usuário" href="/account/signup">&nbsp;<span>Novo usuário</span></a>

    <a class="button icon-help with-text" title="Eu esqueci a minha senha!" href="/account/forgot_password">&nbsp;<span>Eu esqueci a minha senha!</span></a>
<br style="clear: left;" /></div>
</div><!-- end class="login-box" -->


      </div>

        <span class='or'>ou</span> <span class='signup'><a href="/account/signup"><strong>Registre-se</strong></a></span>
    </span>
  <form action="/search/articles" id="top-search" class="search_form clean" method="get">
    <input name="query" size="15" title="Busca..." onfocus="this.form.className='focused';" onblur="this.form.className=''" />
    <div>Aperte <strong>Enter</strong> para enviar a consulta.</div>
    <script>
//<![CDATA[
jQuery("#user form input").hint();
//]]>
</script>
  </form>
</div><!-- end id="user" -->

        <h1 id="site-title">
          <a href="/"><span>Software livre Brasil</span></a>

        </h1>
        <div id="navigation">
          <ul>
            <div id="friends">
<ul>
  <li><a href="/portal"><span>+</span></a></li>
  <li><a href="http://br-linux.org"><span>BR-Linux</span></a></li>
  <li><a href="http://www.vivaolinux.com.br"><span>Viva o Linux</span></a></li>
  <li><a href="http://www.revista.espiritolivre.org"><span>Revista Espírito Livre</span></a></li>
  <li><a href="http://www.dicas-l.com.br"><span>Dicas-L</span></a></li>
  <li><a href="http://www.sejalivre.org"><span>Seja Livre</span></a></li>
  <li><a href="http://www.underlinux.com.br"><span>Under Linux</span></a></li>
  <li><a href="http://www.sempreupdate.com.br"><span>Sempre Update</span></a></li>
</ul>
</div>
<div id="external-links">
<ul>
  <li><a id="blogoosfero" title="Blogoosfero" href="http://blogoosfero.cc/software-livre" target="_blank"><span>Blogoosfero</span></a></li>
  <li><a id="twitter" title="Twitter" href="https://twitter.com/PSLBrasil" target="_blank"><span>Twitter</span></a></li>
  <li><a id="diaspora" title="Diaspora" href="https://diaspora.softwarelivre.org/u/pslbrasil" target="_blank"><span>Diaspora</span></a></li>
  <li><a id="gnu-social" title="Quitter" href="https://quitter.se/pslbrasil" target="_blank"><span>Quitter</span></a></li>
  <li><a id="feed" title="Feed" href="http://softwarelivre.org/portal/feed"><span>Feed</span></a></li>
</ul>
</div>

          </ul>
          <div id="navigation-end"></div>
        </div><!-- end id="navigation" -->
        <div id="content">
          <div id="content-inner">
  <div id="profile-header"></div><div class="boxes" id="boxes"><div class="box box-3" id="box-1830"><div class="blocks">    <div class="block-outer"><div class="block friends-block" id="block-3450" help="Clicando em um amigo você será enviado a página inicial dele"><div class="block-inner-1"><div class="block-inner-2">
<div class="block-header"><h3 class="block-title"><span>1 amigos</span></h3><h4 class="block-subtitle empty"><span></span></h4></div>

<div>
    <ul>
      <div class="common-profile-list-block has-pic"><li class="vcard"><a class="person-trigger menu-submenu-trigger" url="/profile/furusho/check_friendship" onclick="toggleSubmenu(this, 'Furusho', [{&quot;Mural&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/profile/furusho&quot;}},{&quot;Amigos&quot;:{&quot;href&quot;:&quot;/profile/furusho/friends&quot;}},{&quot;Comunidades&quot;:{&quot;href&quot;:&quot;/profile/furusho/communities&quot;}},{&quot;Enviar e-mail&quot;:{&quot;href&quot;:&quot;/contact/furusho/new&quot;,&quot;class&quot;:&quot;send-an-email&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;Adicionar&quot;:{&quot;href&quot;:&quot;/profile/furusho/add&quot;,&quot;class&quot;:&quot;add-friend&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;home&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/furusho&quot;}}]); return false" href="#"><span>Links do perfil</span></a><a class="profile_link url" style="" title="Vitorio Furusho" href="http://softwarelivre.org/furusho"><span class="profile-image"><img alt="Vitorio Furusho" title="" class=" photo" src="/image_uploads/0008/5119/Furusho_com_logo_TDF_minor.png" /></span><span class="fn">Furusho</span><span class="extra_info"></span></a></li></div>

    </ul>
  <br style="clear:both" />
</div>
<div class="block-footer-content"><a class="view-all" href="/profile/andre-ferraro/friends">Ver todos</a>

</div></div></div></div></div>

    <div class="block-outer"><div class="block communities-block" id="block-3451" help="Este bloco exibe as comunidades das quais o usuário é membro."><div class="block-inner-1"><div class="block-inner-2"><div class="block-header"><h3 class="block-title"><span>2 comunidades</span></h3><h4 class="block-subtitle empty"><span></span></h4></div>


<div>
    <ul><div class="common-profile-list-block has-pic"><li class="vcard"><a class="community-trigger menu-submenu-trigger" url="/profile/fisl/check_membership" onclick="toggleSubmenu(this, 'FISL - Fórum Internacional do Softwar...', [{&quot;Mural&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/profile/fisl&quot;}},{&quot;Integrantes&quot;:{&quot;href&quot;:&quot;/profile/fisl/members&quot;}},{&quot;Agenda&quot;:{&quot;href&quot;:&quot;/profile/fisl/events&quot;}},{&quot;Entrar&quot;:{&quot;href&quot;:&quot;/profile/fisl/join&quot;,&quot;class&quot;:&quot;join-community&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;Sair da comunidade&quot;:{&quot;href&quot;:&quot;/profile/fisl/leave?reload=false&quot;,&quot;class&quot;:&quot;leave-community&quot;,&quot;style&quot;:&quot;display:  none&quot;}},{&quot;Enviar e-mail&quot;:{&quot;href&quot;:&quot;/contact/fisl/new&quot;,&quot;class&quot;:&quot;send-an-email&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;home&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/fisl&quot;}}]); return false" href="#"><span>Links do perfil</span></a><a class="profile_link url" style="" title="FISL - Fórum Internacional do Software Livre" href="http://softwarelivre.org/fisl"><span class="profile-image"><img alt="FISL - Fórum Internacional do Software Livre" title="" class=" logo" src="/image_uploads/0000/0747/fisl_minor.jpg" /></span><span class="org">FISL - Fórum Internacional do Softwar...</span><span class="extra_info"></span></a></li></div>
 <div class="common-profile-list-block has-pic"><li class="vcard"><a class="community-trigger menu-submenu-trigger" url="/profile/portal/check_membership" onclick="toggleSubmenu(this, 'PSL Brasil', [{&quot;Mural&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/profile/portal&quot;}},{&quot;Integrantes&quot;:{&quot;href&quot;:&quot;/profile/portal/members&quot;}},{&quot;Agenda&quot;:{&quot;href&quot;:&quot;/profile/portal/events&quot;}},{&quot;Entrar&quot;:{&quot;href&quot;:&quot;/profile/portal/join&quot;,&quot;class&quot;:&quot;join-community&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;Sair da comunidade&quot;:{&quot;href&quot;:&quot;/profile/portal/leave?reload=false&quot;,&quot;class&quot;:&quot;leave-community&quot;,&quot;style&quot;:&quot;display:  none&quot;}},{&quot;Enviar e-mail&quot;:{&quot;href&quot;:&quot;/contact/portal/new&quot;,&quot;class&quot;:&quot;send-an-email&quot;,&quot;style&quot;:&quot;display: none&quot;}},{&quot;home&quot;:{&quot;href&quot;:&quot;http://softwarelivre.org/portal&quot;}}]); return false" href="#"><span>Links do perfil</span></a><a class="profile_link url" style="" title="PSL-Brasil" href="http://softwarelivre.org/portal"><span class="profile-image"><img alt="PSL-Brasil" title="" class=" logo" src="/image_uploads/0008/3041/g8733_minor.png" /></span><span class="org">PSL Brasil</span><span class="extra_info"></span></a></li></div></ul>
</div>

<br style='clear:both'/>
<div class="block-footer-content">    <a class="view-all" href="/profile/andre-ferraro/communities">Ver todas</a>

</div></div></div></div></div>
</div></div>
<div class="box box-2" id="box-1829"><div class="blocks">  <div class="block-outer"><div class="block profile-image-block" id="block-3448" help="Este bloco apresenta a imagem do perfil"><div class="block-inner-1"><div class="block-inner-2"><div class="vcard">


<div class="profile-big-image img-pic">
  <div class="profile-big-image-inner1">
    <div class="profile-big-image-inner2">
      <a href="http://softwarelivre.org/andre-ferraro"><img alt="Andre Ferraro" title="" class=" photo" src="/image_uploads/0000/2212/avatar_big.jpg" />
</a>
    </div>
  </div>
</div>

  <p>Ferraro</p>


<div class="profile-info-options">
  <ul>
</ul>

</div>
</div><!-- end class="vcard" -->
</div></div></div></div>

    <div class="block-outer"><div class="block link-list-block" id="block-3449" help="Este bloco pode ser usado para criar um menu de links. Você pode incluir, remove e atualizar links como quiser."><div class="block-inner-1"><div class="block-inner-2"><div class="block-header"><h3 class="block-title empty"><span></span></h3><h4 class="block-subtitle empty"><span></span></h4></div>



<ul>
    <li>
      <a class="icon-menu-people" href="/profile/andre-ferraro">Perfil</a>
    </li>
    <li>
      <a class="icon-photos" href="/andre-ferraro/galeria">Galeria de fotos</a>
    </li>
    <li>
      <a class="icon-send" href="/contact/andre-ferraro/new">Contato</a>
    </li>
    <li>
      <a class="icon-edit" href="/andre-ferraro/blog">Blog</a>
    </li>
</ul>
</div></div></div></div>
</div></div>
<div class="box box-1" id="box-1828"><div class="blocks">  <div class="block-outer"><div class="block main-block" id="block-3447" help="Este bloco apresenta o conteúdo principal das suas páginas."><div class="block-inner-1"><div class="block-inner-2"><div class="main-content">
<div id="article" class="blog">



<script type="text/javascript">
    window.ONE_COMMENT = "Um comentário";
    window.COMMENT_PLURAL = "comentários";
    window.NO_COMMENT_YET = "Sem comentários ainda";
</script>


<div id="article-toolbar">
  <div>
  <div id="article-actions">

    
      <script>fullscreenPageLoad('#article')</script>
    <a id="fullscreen-btn" onClick="toggle_fullwidth(&#39;#article&#39;)" class="button with-text icon-fullscreen" href="#" title="Ir para o modo tela cheia"><span>Tela cheia</span></a><a style="display: none;" id="exit-fullscreen-btn" onClick="toggle_fullwidth(&#39;#article&#39;)" class="button with-text icon-fullscreen" href="#" title="Sair do modo tela cheia"><span>Sair da tela cheia</span></a>









    

    

  </div>
  <div id="article-header">
    <a class="button icon-feed blog-feed-link" title="Feed RSS" href="http://softwarelivre.org/andre-ferraro/blog/feed">&nbsp;<span>Feed RSS</span></a>
    
      <h1 class="title">
    Blog
  </h1>
  <span class="publishing-info">
  <span class="date">
    27 de Maio de 2009, 0:00
  </span>
  <span class="author">
    , por Software Livre Brasil
  </span>
  <span class="comments">
     - 
  </span>

<span class="followers-count">
|
    Ninguém está seguindo este artigo ainda.
</span>

</span>



    
  </div>
</div>

</div>



  <div id="addThis">
  <script type="text/javascript">
    addthis_pub = 'ra-4d93d22a7a91a05f';
    addthis_logo = '';
    addthis_options = 'identica, twitter, www.facebook.com, favorites, email, delicious, tumblr, digg, slashdot, more';
  </script>
  <a href="http://www.addthis.com/bookmark.php" id="bt_addThis" target="_blank" onmouseover="return addthis_open(this, '', '[URL]')" onmouseout="addthis_close()" onclick="return addthis_sendto()"><img width="53" height="16" border="0" alt="" src="/images/bt-bookmark.gif" /></a>
</div>


  <div class="article-body article-body-blog">
    


<div>
  <div class='blog-description'>
    
  </div>
</div>
<hr class="pre-posts"/>
<div class="blog-posts page-3">
  <div id="post-3180" class="blog-post position-1 first odd-post"><div class="odd-post-inner blog-post-inner"><h1 class="title"><a href="http://softwarelivre.org/andre-ferraro/blog/linux-compartilhando-a-conexao-de-internet">Linux: Compartilhando a conexão de Internet</a></h1><span class="publishing-info"><span class="date">14 de Maio de 2009, 0:00</span><span class="author">, por Software Livre Brasil</span><span class="comments"> - <a href="/andre-ferraro/blog/linux-compartilhando-a-conexao-de-internet#comments_list"><span class='comment-count hide'>1</span><span class='comment-count-write-out'>Um comentário</span></a></span></span><div class="snap_preview">
<br><div class="wp-caption alignleft" style="width: 225px;">
<img title="Compartilhando a conexão de Internet" class="size-full wp-image-342" src="http://andreferraro.files.wordpress.com/2009/05/internet-compartilhamento.jpg?w=215&amp;#038;h=300" height="300" alt="Compartilhando a conexão de Internet" width="215"><p class="wp-caption-text">Compartilhando a conexão de Internet</p>
</div>
<p>Apesar de ser uma tarefa básica para quem administra redes <em>Linux</em>, o compartilhamento de conexão de Internet pode ser uma questão importante para quem está iniciando e deseja utilizar o <em>Linux</em> como <a href="http://pt.wikipedia.org/wiki/Gateway" title="Wikipedia: Gateway" target="_blank"><em>gateway</em></a> de sua rede local.</p>
<p>A primeira coisa que precisamos compreender é o <strong>NAT</strong> ou <em>Network Address Translation</em>. Também chamado de <em>masquerading</em> (mascaramento), é o processo de transformar ou traduzir endereços IP de uma rede para outra, no caso de compartilhamento de Internet, o <strong>NAT</strong> faz a tradução de IPs da rede local em endereço IP da Internet, permitindo assim que máquinas da sua rede local acessem a Internet. Com isso, um único endereço IP de Internet, pode ser compartilhado com todos os IPs da sua rede local.<span></span></p>
<p>Ao utilizar um <em>gateway</em> cada <a href="http://informatica.hsw.uol.com.br/questao525.htm" title="HSW: Pacote de Dados" target="_blank">pacote de dados</a> é traduzido pelo NAT e é reconhecido como oriundo do IP de Internet, ou seja, independente do IP do computador da rede local, todos os pacotes saem para Internet como sendo do IP de Internet. Quando este pacote retorna, o NAT faz a tradução novamente para direcioná-lo ao computador de origem.</p>
<h2>Compartilhando a conexão de Internet</h2>
<p>Antes de começarmos a configurar nosso <em>gateway</em> de compartilhamento de Internet, vamos verificar o ambiente a ser utilizado. Para que as configurações funcionem perfeitamente você precisará de um ambiente semelhante a este:</p>
<ul>
<li>Uma conexão (que esteja funcionando) com um provedor de Internet;</li>
<li>Uma máquina com o <em>Debian</em> ou <em>Ubuntu</em> instalado;</li>
<li>Duas placas de rede instaladas, sendo que uma delas já deve estar com as configurações do provedor de Internet;</li>
<li>Um <a href="http://pt.wikipedia.org/wiki/Concentrador"><em>hub</em></a> ou <a href="http://pt.wikipedia.org/wiki/Comutador_(redes)"><em>switch</em></a> para distribuir o acesso à Internet por vários computadores.</li>
</ul>
<p>Abaixo segue uma sugestão simples de topologia de rede:</p>
<div class="wp-caption aligncenter" style="width: 411px;">
<img title="LAN: Topologia de uma rede simples" class="size-full wp-image-345" src="http://andreferraro.files.wordpress.com/2009/05/topologia-rede-simples.jpg?w=401&amp;#038;h=312" height="312" alt="LAN: Topologia de uma rede simples" width="401"><p class="wp-caption-text">LAN: Topologia de uma rede simples</p>
</div>
<h3>Liberando o encaminhamento de pacotes</h3>
<p>A primeira configuração à fazer é liberar o encaminhamento de pacotes IP. Para isso temos duas alternativas. A primeira é alterar o arquivo <strong>ip_forward</strong> inserindo 1 no seu conteúdo e a segundo é alterando o arquivo <strong>sysctl.conf</strong>.</p>
<p>Inserindo 1 no arquivo <strong>ip_forward</strong>:</p>
<p><code># echo 1 &gt; /proc/sys/net/ipv4/ip_forward</code></p>
<p>Alterar o arquivo <strong>sysctl.conf</strong>:</p>
<p><code># vi /etc/sysctl.conf</code></p>
<p>Remova o símbolo <strong>#</strong> da linha:</p>
<p><code>net.ipv4.ip_forward = 1</code></p>
<p>Salve o arquivo com <em>“:wq!”</em>. Para mais informações sobre o arquivo <em>sysctl.conf</em>, basta digitar o comando:</p>
<p><code># man sysctl.conf</code></p>
<h3>Configurando o IP do Gateway</h3>
<p>Vamos seguir o exemplo de topologia acima e admitir que temos duas placas de rede e iremos utilizar a placa nomeada como <strong>eth0</strong> para acesso à Internet (<a href="http://pt.wikipedia.org/wiki/Rede_de_longa_dist%C3%A2ncia" title="Wikipedia: Rede de longa distância" target="_blank"><strong>WAN</strong></a>) e a placa <strong>eth1</strong> para acesso à rede local (<a href="http://pt.wikipedia.org/wiki/Rede_de_%C3%A1rea_local" title="Wikipedia: Rede de área local" target="_blank">LAN</a>).</p>
<p>Dica: Para sabermos maiores informações sobre nossas placas de rede, podemos utilizar o comando:</p>
<p><code># cat /var/log/dmesg | grep eth</code></p>
<p>Este comando deverá retornar o <a href="http://pt.wikipedia.org/wiki/Chipset" title="Wikipedia: Chipset" target="_blank"><em>chipset</em></a> da placa de rede e a nomeação definida pelo <em>Linux</em>.</p>
<p>Após verificarmos corretamente as placas de rede e ligarmos os cabos que foram “feitos” utilizando o padrão <a href="http://pt.wikipedia.org/wiki/CAT5e" title="Wikipedia: CAT5e" target="_blank"><strong>CAT5e</strong></a>, vamos então configurar manualmente às informações da rede. Como estamos utilizando o <strong>Debian Lenny</strong> (<em>Debian 5.0</em>) ou <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>), então as configurações estão no arquivo <em>/etc/network/interfaces</em>. Vamos editá-lo:</p>
<p><code># vi /etc/network/interfaces</code></p>
<p>O arquivo deverá ficar semelhante com o exemplo abaixo:</p>
<p><code>auto lo</code><br>
<code>iface lo inet loopback</code></p>
<p><code>allow-hotplug eth0</code><br>
<code>iface eth0 inet dhcp</code></p>
<p><code>allow-hotplug eth1</code><br>
<code>iface eth1 inet static</code><br>
<code> address 192.168.0.1</code><br>
<code> netmask 255.255.255.0</code></p>
<p>Note que não informo endereço de <em>gateway</em> na placa que será responsável por receber todo o tráfego da rede local (<em>LAN</em>). Isto é feito, pois esta máquina é o <em>gateway</em> da rede local.</p>
<p>No <strong>Ubuntu</strong>, a configuração padrão não menciona <em>allow-hotplug eth0</em> e sim <em>auto eth0</em>.</p>
<p>Caso sua conexão à Internet for através de IP fixo, então as configurações da <em>eth0</em> podem ser semelhantes a esta:</p>
<p><code>allow-hotplug eth0</code><br>
<code>iface eth0 inet static</code><br>
<code> address 200.174.144.20</code><br>
<code> netmask 255.255.255.240</code><br>
<code> broadcast 200.174.144.31</code><br>
<code> gateway 200.174.144.17</code></p>
<h3>Usando o IPTables para compartilhamento da conexão de Internet</h3>
<p>O IPTables é o software responsável por configurar regras de filtragem de pacotes. Para utilizar o <strong>IPTables</strong> para compartilharmos o acesso a Internet, antes precisaremos informar ao <a href="http://pt.wikipedia.org/wiki/Kernel" title="Wikipedia: Kernel" target="_blank"><em>Kernel</em></a> os módulos que deverão ser carregados.</p>
<p><code># modprobe ip_tables</code><br>
<code># modprobe iptable_nat</code></p>
<p>O comando <strong>modprobe</strong> é responsável por, além de outras tarefas, adicionar ou remover módulos no <em>Kernel Linux</em>. Os módulos <strong>ip_tables</strong> e <strong>iptables_nat</strong> têm a função de adicionar ao <em>Kernel</em> a habilidade de filtrar os pacotes de dados e fazer a “tradução” dos endereços de IP de uma rede para outra.</p>
<p>Agora vamos limpar qualquer regra pré-existente no <strong>IPTables</strong>, para que possamos garantir o correto funcionamento do <em>NAT</em> e do encaminhamento de pacotes:</p>
<p><code># iptables -F INPUT</code><br>
<code># iptables -F OUTPUT</code><br>
<code># iptables -F FORWARD</code><br>
<code># iptables -F -t nat</code><br>
<code># iptables -F -t mangle</code></p>
<p>As linhas acima limpam informações de entrada, saída, encaminhamento, “tradução” e alteração de pacotes.</p>
<p>Por fim, vamos habilitar o encaminhamento de pacotes via IPTables:</p>
<p><code># iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></p>
<p>Entendendo os parâmetros passados para o IPTables na linha acima:</p>
<ul>
<li>
<strong>-t nat</strong> – utiliza a tabela de “tradução” de endereços IP;</li>
<li>
<strong> -A POSTROUTING</strong> – adiciona a regra para saída de pacotes;</li>
<li>
<strong>-o eth0</strong> – especifica que a interface de saída utilizada é <em>eth0</em>;</li>
<li>
<strong>-j MASQUERADE</strong> – informa que o foco (<em>target</em>) da regra é o mascaramento de IP.</li>
</ul>
<h3>Testando a conexão de Internet</h3>
<p>Para testar se as configurações funcionaram, basta utilizar o comando <em>ping</em> de uma das máquinas clientes da rede. Por exemplo:</p>
<p><code># ping www.google.com.br</code></p>
<h3>Monitorando a transferência de pacotes</h3>
<div class="wp-caption alignleft" style="width: 160px;">
<img title="Monitorando interfaces com IFTop" class="size-thumbnail wp-image-379" src="http://andreferraro.files.wordpress.com/2009/05/iftop.png?w=150&amp;#038;h=91" height="91" alt="Monitorando interfaces com IFTop" width="150"><p class="wp-caption-text">Monitorando interfaces com IFTop</p>
</div>
<p><strong>IFTop</strong> é um ótimo utilitário para monitorar a transferência de pacotes entre sua rede local e a Internet. Com ele podemos ver, em tempo real, quais são os sites acessados e medir a taxa de transferência. Para instalar o <em>IFTop</em> no <strong>Debian Lenny</strong> (<em>Debian 5.0</em>) ou <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>) basta executar o comando:</p>
<p><code># apt-get install iftop</code></p>
<p>Para utilizá-lo basta especificar a interface (placa) de rede que deseja monitorar. Em nosso exemplo de topologia a placa nomeada como <em>eth0</em> é a responsável pelo tráfego de Internet. Para monitorá-la vamos utilizar o comando:</p>
<p><code># iftop -i eth0</code></p>
<p>Caso tenha criado um <em>script</em> com as configurações acima, então você poderá adicioná-lo automaticamente à inicialização do sistema com o comando:</p>
<p><code># update-rc.d &lt;nome-do-script&gt; defaults</code></p>
<h3>Fontes e Referências</h3>
<ul>
<li>
<a href="http://en.wikipedia.org/wiki/Network_address_translation" title="Wikipedia: NAT" target="_blank">Wikipedia – NAT</a>;</li>
<li>
<a href="http://computer.howstuffworks.com/nat.htm" title="HSW: NAT" target="_blank">How Stuff Works – NAT</a>;</li>
<li>
<a href="http://www.howtoforge.com/internet-connection-sharing-masquerading-on-linux" title="How to masquerade on Linux" target="_blank">How to masquerade on Linux</a>;</li>
<li>
<a href="http://linux.die.net/man/8/iftop" title="iftop: display bandwidth usage on a interface" target="_blank">iftop: display bandwidth usage on an interface</a>;</li>
<li>man iptables, man iftop.</li>
</ul>
Posted in Redes Tagged: 9.04, compartilhamento, conexão, configuração, configurando, debian, debian 5.0, debian lenny, gateway, howto, iftop, instalação, instalando, Internet, iptables, ip_forward, jaunty, linux, mascaramento, masquerade, masquerading, modprobe, monitoramento, nat, Redes, script, sysctl.conf, tutorial, ubuntu, ubuntu jaunty <a href="http://feeds.wordpress.com/1.0/gocomments/andreferraro.wordpress.com/340/"><img src="http://feeds.wordpress.com/1.0/comments/andreferraro.wordpress.com/340/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godelicious/andreferraro.wordpress.com/340/"><img src="http://feeds.wordpress.com/1.0/delicious/andreferraro.wordpress.com/340/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/gostumble/andreferraro.wordpress.com/340/"><img src="http://feeds.wordpress.com/1.0/stumble/andreferraro.wordpress.com/340/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godigg/andreferraro.wordpress.com/340/"><img src="http://feeds.wordpress.com/1.0/digg/andreferraro.wordpress.com/340/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/goreddit/andreferraro.wordpress.com/340/"><img src="http://feeds.wordpress.com/1.0/reddit/andreferraro.wordpress.com/340/" border="0" alt=""></a> <img src="http://stats.wordpress.com/b.gif?host=andreferraro.wordpress.com&amp;blog=6980461&amp;post=340&amp;subd=andreferraro&amp;ref=&amp;feed=1" border="0" alt="">
</div><br style="clear:both"/></div></div>
<hr class='sep-posts'/>
<div id="post-3179" class="blog-post position-2 even-post"><div class="even-post-inner blog-post-inner"><h1 class="title"><a href="http://softwarelivre.org/andre-ferraro/blog/linux-instalando-configurando-e-sincronizando-o-relogio-de-servidores-e-clientes-com-ntp-no-debian-ubuntu-e-windows.">Linux: Instalando, configurando e sincronizando o relógio de servidores e clientes com NTP no Debian, Ubuntu e Windows.</a></h1><span class="publishing-info"><span class="date">11 de Maio de 2009, 0:00</span><span class="author">, por Software Livre Brasil</span><span class="comments"> - <a href="/andre-ferraro/blog/linux-instalando-configurando-e-sincronizando-o-relogio-de-servidores-e-clientes-com-ntp-no-debian-ubuntu-e-windows.#comments_list"><span class='comment-count hide'>1</span><span class='comment-count-write-out'>Um comentário</span></a></span></span><div class="snap_preview">
<br><div class="wp-caption alignleft" style="width: 225px;">
<img title="Servidor NTP: Hora oficial e sincronizada." class="size-full wp-image-326" src="http://andreferraro.files.wordpress.com/2009/05/servidor-ntp.jpg?w=215&amp;#038;h=300" height="300" alt="Servidor NTP: Hora oficial e sincronizada." width="215"><p class="wp-caption-text">Servidor NTP: Hora oficial e sincronizada.</p>
</div>
<p>Notei, nesses vários anos que trabalho com redes, que não é a maioria dos administradores que se preocupam com a configuração perfeita da data e hora dos servidores. Uma rede com o horário dessincronizado pode gerar sérios problemas de administração, como por exemplo: falhas em servidores de controle de versão, problemas com sistemas de <em>backup</em>, erro em transações de banco de dados, não funcionamento do <em>Active Directory</em> ou quando precisamos analisar <em>LOGs</em> de vários servidores por causa de alguma ocorrência na rede. Ah, tem até aquele caso comum de um e-mail cuja resposta tem hora inferior ao do primeiro e-mail enviado.<span></span></p>
<p>Para resolver essa situação existe o <strong>NTP</strong> (<em>Network Time Protocol</em>) que tem como finalidade sincronizar relógios na rede, seja ela, rede local ou a Internet. Através do <em>NTP</em> podemos sincronizar nossas máquinas com a data e hora provida por órgãos responsáveis pela hora legal no país, como é o caso do <a href="http://ntp.br/" target="_blank">NTP.br</a> e o <a href="http://www.on.br/" target="_blank">Observatório Nacional</a>.</p>
<p>Uma informação pertinente é que os servidores de <strong>NTP</strong>, como do Observatório Nacional, têm como referência <a href="http://pt.wikipedia.org/wiki/Rel%C3%B3gio_at%C3%B4mico" target="_blank">relógios atômicos</a> ou <a href="http://pt.wikipedia.org/wiki/Gps" target="_blank">GPS</a>.</p>
<p>O processo de sincronização é feito através de <a href="http://pt.wikipedia.org/wiki/Algoritmo" target="_blank">algorítimos</a> e mensagens trocadas entre o seu servidor <em>NTP</em> local com o servidor <em>NTP</em> de referência, possibilitando a determinação exata da hora que será utilizada em seu servidor e a partir daí o processo é repetido entre seu servidor <em>NTP</em> local com as demais máquinas de sua rede.</p>
<h2>Instalação e configuração do servidor NTP</h2>
<p>O <strong>servidor NTP</strong>, ou <strong>NTPd</strong> (<a href="http://pt.wikipedia.org/wiki/Daemon_%28aplicativo_para_computadores%29" target="_blank">daemon</a>) é instalável em todos as distribuições <em>Linux</em> e sua função é justamente se comunicar com servidores de referência e depois propagar a data e hora pelos computadores clientes da rede.</p>
<p>Antes de começarmos a instalação que é compatível tanto como <strong>Debian Lenny</strong> (<em>Debian 5.0</em>) quanto com o <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>), vamos primeiro atualizar nossa lista de repositórios do <em>APT</em> com o comando:</p>
<p><code># apt-get update</code></p>
<h3>Instalando o servidor NTP</h3>
<p>Após atualizar a lista de repositórios, basta executarmos o comando para instalação:</p>
<p><code># apt-get install ntp ntpdate<br>
</code></p>
<p>O <em>deamon</em> do <strong>NTP</strong> utiliza pouco mais de um megabyte de espaço em disco e não adiciona pacotes extras, exceto no <em>Debian</em> onde pacote <strong>libcap1</strong> é instalado. O <strong>libcap1</strong> tem como função particionar os privilégios do <em>root</em> para utilização de vários serviços como o <strong>NTPd</strong>.</p>
<p>Outra necessidade percebida no Debian é a instalação do <strong>ntpdate</strong>, com este utilitário é possível atualizar o relógio diretamente com um servidor NTP de referência.</p>
<h2>Configurando o NTPd no Debian Lenny (Debian 5.0) e Ubuntu Jaunty (Ubuntu 9.04)</h2>
<p>Após a instalação, precisamos nos certificar que o horário de nosso computador não está mais que 16 minutos atrasado ou adiantado. Vamos utilizar o comando abaixo para atualizar o horário do computador com o servidor NTP padrão de referência:</p>
<p><code># ntpd -q -g</code></p>
<p>Após a atualização do horário através dos servidores padrões do <em>Debian</em> e do <em>Ubuntu</em>, o <strong>NTP</strong> utiliza o arquivo <strong>ntp.drift</strong>. O <strong>ntp.drift</strong> registra a instabilidade na freqüência do relógio do seu computador e o <em>NTP</em> o utiliza este registro para sincronizar corretamente o relógio do seu equipamento com o do servidor de referência. Algumas distribuições <em>Linux</em> não criam o arquivo automaticamente no momento da instalação, porém o <strong>Debian Lenny</strong> (<em>Debian 5.0</em>) e o <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>) o criam corretamente.</p>
<h3>Configurando o servidor NTP via ntp.conf</h3>
<p>O arquivo responsável pela configuração do <em>servidor NTP</em> é o <strong>ntp.conf</strong> que no <em>Debian</em> e <em>Ubuntu</em> está localizado em <strong>/etc/ntp.conf</strong>. Nas duas distribuições o <strong>ntp.conf</strong> é idêntico, salvo é claro o servidor NTP de referência, que no <em>Ubuntu</em> é <em>ntp.ubuntu.com</em> e no <em>Debian</em> são quatro servidores, onde o primeiro é <em>0.debian.pool.ntp.org</em>.</p>
<p>Vamos agora entender a estrutura do arquivo para definirmos uma configuração usual.</p>
<p>A primeira linha faz referência a localização do arquivo <em>ntp.drift</em> que comentei um pouco acima neste <em>post</em>. Verifique se ele está criado no diretório apontado em seu arquivo de configuração. Caso não esteja criado, então utilize o comando abaixo:</p>
<p><code># touch /var/lib/ntp/ntp.drift</code></p>
<p>Caso você deseje monitorar seu servidor <em>NTP</em> através de <em>LOGs</em>, então “descomente” (retire o caracter #) da linha <strong>statsdir</strong>. Não esqueça de “descomentar” também as linhas de <strong>filegen</strong>, pois serão utilizadas para definir as informações gravadas em <em>log</em>.</p>
<p>O terceiro item do arquivo de configuração é relativo ao servidor NTP de referência, ele deve ser configurado no padrão:</p>
<p><code>server &lt;endereço-do-servidor&gt; &lt;opções&gt;</code></p>
<p>Existem doze itens de configuração de servidor. Eu recomendo a utilização de três opções, são elas:</p>
<ul>
<li>
<strong>iburst</strong> – quando o <em>NTPd</em> não localiza o servidor, então ele envia oito pacotes, ao invés de dois pacotes (padrão), assim mesmo que sua conexão apresente alguma instabilidade o NTPd tentará mais contatos com o <em>servidor NTP</em> de referência;</li>
<li>
<strong>prefer</strong> – define o <em>servidor NTP</em> de referência como preferencial;</li>
<li>
<strong>dynamic</strong> – permite que um servidor, mesmo que inalcançável, ainda seja contatado futuramente, pois sua rede local ou sua conexão de internet pode ter falhado ou esteja com sinal intermitente.</li>
</ul>
<p>Sugiro estes cinco servidores:</p>
<ul>
<li>a.ntp.br – Servidor da NTP.br ;</li>
<li>ntp.ansp.br – Servidor do NARA (núcleo de apoio a rede acadêmica);</li>
<li>ntp.cais.rnp.br – Servidor da RNP (rede nacional de pesquisa);</li>
<li>b.ntp.br – Servidor da NTP.br;</li>
<li>c.ntp.br – Servidor da NTP.br.</li>
</ul>
<p>É importante, por questões de segurança, que não seja permitido que estes servidores NTP de referência façam qualquer alteração no horário, pois estes são para consulta e a alteração de horário deverá ser feita localmente, então vamos colocar uma regra de restrição de alteração e consulta para estes servidores. Configuramos estes parâmetros dentro da configuração de restrict, como por exemplo:</p>
<p><code>restrict &lt;endereço-do-servidor&gt; mask 255.255.255.255 nomodify noquery</code></p>
<p>Eu não modifico a configuração padrão das primeiras quatro linhas contendo o item o chamada <strong>restrict</strong>, pois desejo que meu <em>servidor NTP</em> troque horário com qualquer computador, porém não permitindo alteração de configuração e também permito que usuários do próprio computador façam consultas ao servidor. A única configuração de restrição que eu faço é a inserção da linha:</p>
<p><code>restrict &lt;rede-local&gt; mask &lt;máscara-de-rede&gt;</code></p>
<p>A linha acima deve ser utilizada para liberar todas as máquinas da rede local para acessarem o <em>servidor de NTP</em>.</p>
<h3>Exemplo de configuração do ntp.conf</h3>
<p>Abaixo segue meu exemplo de configuração do ntp.conf:</p>
<p><code>driftfile /var/lib/ntp/ntp.drift</code></p>
<p><code>statsdir /var/log/ntpstats/</code><br>
<code>statistics loopstats peerstats clockstats</code><br>
<code>filegen loopstats file loopstats type day enable</code><br>
<code>filegen peerstats file peerstats type day enable</code><br>
<code>filegen clockstats file clockstats type day enable</code></p>
<p><code>server a.ntp.br prefer iburst dynamic</code><br>
<code>server ntp.ansp.br iburst dynamic</code><br>
<code>server ntp.cais.rnp.br iburst dynamic</code><br>
<code>server b.ntp.br iburst dynamic</code><br>
<code>server c.ntp.br iburst dynamic</code></p>
<p><code>restrict a.ntp.br mask 255.255.255.255 nomodoify noquery</code><br>
<code>restrict ntp.ansp.br mask 255.255.255.255 nomodoify noquery</code><br>
<code>restrict ntp.cais.rnp.br mask 255.255.255.255 nomodoify noquery</code><br>
<code>restrict b.ntp.br iburst mask 255.255.255.255 nomodoify noquery</code><br>
<code>restrict c.ntp.br iburst mask 255.255.255.255 nomodoify noquery</code></p>
<p><code>restrict -4 default kod notrap nomodify nopeer noquery</code><br>
<code>restrict -6 default kod notrap nomodify nopeer noquery</code><br>
<code>restrict 127.0.0.1</code><br>
<code>restrict ::1</code><br>
<code>restrict 192.168.0.0 mask 255.255.255.0</code></p>
<p>Depois de salvar (gravar) o arquivo, não vamos reiniciar o serviço ainda. Primeiro vamos parar o servidor NTP (caso esteja rodando) e sincronizar o horário, do nosso servidor <em>NTP</em>, com os comandos:</p>
<p><code># /etc/init.d/ntp stop<br>
# ntpdate a.ntp.br</code></p>
<p>Após feita sincronização de horário com um <em>servidor NTP</em> de referência, então vamos reiniciar o serviço de <em>NTP</em> com o comando:</p>
<p><code># /etc/init.d/ntp force-reload</code></p>
<h2>Verificando se o nosso servidor NTP está sincronizando corretamente</h2>
<p>Para verificarmos se os servidores ao qual estamos tentando sincronizar estão fornecendo respostas e nosso <em>servidor NTP</em> está sincronizando o horário corretamente, precisaremos executar o comando de consulta. O resultado é atualizado constantemente nos dois primeiros dias de sincronização, pois as informações de frequência ainda estão sendo atualizadas no arquivo <em>ntp.drift</em>.</p>
<p>Comando de consulta da situação de sincronização:</p>
<p><code># ntpq -p</code></p>
<p>O resultado deve variar, mas pode ser como o abaixo:</p>
<table border="0">

<tr>
<td><code>remote</code></td>
<td><code>refid</code></td>
<td><code>st</code></td>
<td><code>t</code></td>
<td><code>when</code></td>
<td><code>poll</code></td>
<td><code>reach</code></td>
<td><code>delay</code></td>
<td><code>offset</code></td>
<td><code>jitter</code></td>
</tr>
<tr>
<td><code>==============================================================================</code></td>
</tr>
<tr>
<td><code> a.ntp.br</code></td>
<td><code>.INIT.</code></td>
<td><code>16</code></td>
<td><code>u</code></td>
<td><code>-</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
</tr>
<tr>
<td><code> ns2.ansp.br</code></td>
<td><code>.STEP.</code></td>
<td><code>16</code></td>
<td><code>u</code></td>
<td><code>482</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.001</code></td>
</tr>
<tr>
<td><code> titan.cais.rnp.</code></td>
<td><code>.STEP.</code></td>
<td><code>16</code></td>
<td><code>u</code></td>
<td><code>34m</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.001</code></td>
</tr>
<tr>
<td><code> b.ntp.br</code></td>
<td><code>200.20.186.76</code></td>
<td><code>2</code></td>
<td><code>u</code></td>
<td><code>32</code></td>
<td><code>64</code></td>
<td><code>1</code></td>
<td><code>20.664</code></td>
<td><code>-1.971</code></td>
<td><code>0.001</code></td>
</tr>
<tr>
<td><code> c.ntp.br</code></td>
<td><code>.STEP.</code></td>
<td><code>16</code></td>
<td></td>
<td><code>-</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
</tr>

</table>
<p>Você poderá reparar que os servidores estão marcados como <em>INIT</em> e <em>STEP</em>. Isto acontece, pois nosso servidor é recém configurado e ainda está atualizando as frequências com os servidores NTP de referência. Após alguns minutos a resposta poderá ser como abaixo:</p>
<table border="0">

<tr>
<td><code>remote</code></td>
<td><code>refid</code></td>
<td><code>st</code></td>
<td><code>t</code></td>
<td><code>when</code></td>
<td><code>poll</code></td>
<td><code>reach</code></td>
<td><code>delay</code></td>
<td><code>offset</code></td>
<td><code>jitter</code></td>
</tr>
<tr>
<td><code>==============================================================================</code></td>
</tr>
<tr>
<td><code>a.ntp.br</code></td>
<td><code>.INIT.</code></td>
<td><code>16</code></td>
<td><code>u</code></td>
<td><code>-</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
</tr>
<tr>
<td><code>*ntp.ansp.br</code></td>
<td><code>200.192.232.8</code></td>
<td><code>3</code></td>
<td><code>u</code></td>
<td><code>41</code></td>
<td><code>64</code></td>
<td><code>7</code></td>
<td><code>11.962</code></td>
<td><code>-65.677</code></td>
<td><code>26.804</code></td>
</tr>
<tr>
<td><code>+titan.cais.rnp.</code></td>
<td><code>26.29.7.231</code></td>
<td><code>2</code></td>
<td><code>u</code></td>
<td><code>36</code></td>
<td><code>64</code></td>
<td><code>7</code></td>
<td><code>15.542</code></td>
<td><code>-45.002</code></td>
<td><code>23.074</code></td>
</tr>
<tr>
<td><code>+b.ntp.br</code></td>
<td><code>200.20.186.76</code></td>
<td><code>2</code></td>
<td><code>u</code></td>
<td><code>38</code></td>
<td><code>64</code></td>
<td><code>7</code></td>
<td><code>17.908</code></td>
<td><code>-44.850</code></td>
<td><code>22.019</code></td>
</tr>
<tr>
<td><code>c.ntp.br</code></td>
<td><code>.INIT.</code></td>
<td><code>16</code></td>
<td><code>u</code></td>
<td><code>-</code></td>
<td><code>64</code></td>
<td><code>0</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
<td><code>0.000</code></td>
</tr>

</table>
<h2>Entendendo a resposta do ntpq</h2>
<p>Após utilizar o comando acima, com certeza queremos saber por que alguns servidores possuem um caracter antes do endereço, chamados de Tally Codes. Os Tally Codes<br>
podem variar entre * (asterisco), + (soma), x. Vamos entender qual o significado desses simbolos e qual a função dos itens st, t, when, poll, reach, delay, offset e jitter:</p>
<p>Entendendo os caracteres ou tally codes:</p>
<ul>
<li>* – system peer, servidor escolhido como principal referência;</li>
<li>+ – candidat, servidor utilizado, porém com menor peso;</li>
<li>x – falsetick, servidor descartado por alguma incoerência verificada na execução do algoritimo de sincronização;</li>
<li>- – outlier, servidor funcional, porém geograficamente distante. A distância pode afetar na sincronização;</li>
<li>. – excess, se existir mais de 10 servidores de referência configurados, então os que não estiverem entre os 10 melhores receberão esta marca;</li>
<li># – selected, porém não está entre os 6 principais servidores NTP de referência;</li>
<li> – se não houver marcação, então o servidor de referência foi descartado por não estar respondendo.</li>
</ul>
<p>Verificando as demais informações:</p>
<ul>
<li>st – o ideal é 1 ou 2, pois o estrato 0 é destinado às fontes dos servidores NTP de referência. 16 significa que não está sincronizado;</li>
<li>when – tempo (em segundos) da última consulta;</li>
<li>poll – tempo (em segundos) entre uma consulta e outra;</li>
<li>reach – transformação em decimal do resultado das últimas consultas. 377 mostra que não houveram falhas;</li>
<li>delay – tempo (em milisegundos) de demora entre consultas;</li>
<li>offset – medidas de deslocamento (em miliseguntos), é a diferença de tempo entre nosso servidor NTP e o servidor de referência;</li>
<li>jitter – ou variação, utiliza o offset para informar desvio ou erro do servidor NTP de referência.</li>
</ul>
<p>Outra maneira de consultar a situação do seu servidor NTP é através do Syslog, para isso utilize o comando abaixo:</p>
<p><code># tail -f -n 30 /var/log/syslog | grep ntpd</code></p>
<h2>Configurando o NTP em máquinas clientes</h2>
<p>O processo de configuração do seu servidor NTP nas máquinas existentes em sua rede local é bastante simples. Abaixo vamos ver como executar esta tarefa tanto em clientes <strong>Linux</strong> quanto clientes <strong>Windows</strong>.</p>
<h3>NTP em máquinas Windows</h3>
<p>Apenas três comandos são suficientes para configurar seu servidor NTP em clientes Windows. Para isso siga os passos:</p>
<ol>
<li>Clique em Iniciar</li>
<li>Selecione Todos os Programas</li>
<li>Entre no menu Acessórios</li>
<li>Clique no item Prompt de Comandos</li>
</ol>
<p>Agora no <strong>Prompt de Comandos</strong>, vamos executar os comandos abaixo:</p>
<p><code>C:\&gt; net time /setsntp:"&lt;ip-do-servidor-NTP&gt;"<br>
C:\&gt; net stop w32time<br>
C:\&gt; net start w32time</code></p>
<p>Os comandos acima definem o seu servidor como servidor NTP de referência, pára o serviço de horário do Windows (<em>Windows Time Service</em>) e inicia o <em>Windows Time Service</em>.<br>
Estes passos são válidos para <strong>Windows XP</strong> e <strong>Windows 2003 Server</strong>. Não testei no <em>Windows Vista</em>, porém deve seguir passos semelhantes.</p>
<p>Para verificarmos se o <em>Windows</em> está sincronizando com nosso servidor NTP, então basta executar o comando no <em>Prompt de Comandos</em>:</p>
<p><code>c:\&gt; net time /querysntp</code></p>
<h3>NTP em clientes Linux</h3>
<p>O processo de configuração do <em>NTP</em> em um cliente <em>Linux</em> é muito parecido com o processo de configuração do servidor, ou seja, vamos ter que instalar os pacotes <strong>ntp</strong> e o <strong>ntpdate</strong>:</p>
<p><code># apt-get install ntp ntpdate</code></p>
<p>Vamos criar o arquivo <strong>ntp.drift</strong> (caso não exista):</p>
<p><code># touch /var/lib/ntp/ntp.drift</code></p>
<p>E vamos agora configurar o arquivo <strong>/etc/ntp.conf</strong>. Eu, particularmente, prefiro remover todas as configurações e deixar como o exemplo abaixo:</p>
<p><code>driftfile /var/lib/ntp/ntp.drift<br>
statsdir /var/log/ntpstats/<br>
statistics loopstats peerstats clockstats<br>
filegen loopstats file loopstats type day enable<br>
filegen peerstats file peerstats type day enable<br>
filegen clockstats file clockstats type day enable<br>
server <em>&lt;ip-do-servidor-NTP&gt;</em><br>
restrict 127.0.0.1<br>
restrict <em>&lt;ip-do-servidor-NTP&gt;</em><br>
restrict ::1</code></p>
<p>Salve as configurações e atualize a data e hora do sistema, mas antes vamos parar o serviço de <em>NTP</em> local:</p>
<p><code># /etc/init.d/ntp stop<br>
# ntpdate &lt;ip-do-servidor-NTP&gt;<br>
# /etc/init.d/ntp start</code></p>
<p>Pronto, agora temos nosso servidor e clientes com data e hora atualizadas.</p>
<h2>Fontes e Referências</h2>
<ul>
<li>
<a href="http://www.ntp.br/" title="NTP.br" target="_blank">NTP.br</a>;</li>
<li>
<a href="http://www.eecis.udel.edu/~mills/ntp/html/ntpq.html" title="ntpq - standard NTP query program" target="_blank">ntpq – standard NTP query program</a>;</li>
<li>
<a href="http://www.dicas-l.com.br/sysadmin/sysadmin_20080127.php" title="SysAdmin - Sincronizando o relógio de seu micro com o NTP.br" target="_blank">SysAdmin – Sincronizando o relógio de seu micro com o NTP.br</a>;</li>
<li>
<a href="http://www.g2ctech.com/artigos/uso-de-ntp.html" title="Mantendo o sincronismo da rede com NTP" target="_blank">Mantendo o sincronismo da rede com NTP</a>;</li>
<li>
<a href="http://www.linuxhomenetworking.com/wiki/index.php/Quick_HOWTO_:_Ch24_:_The_NTP_Server" title="Quick HOWTO : Ch24 : The NTP Server" target="_blank">Quick HOWTO : Ch24 : The NTP Server</a>;</li>
<li>
<a href="http://www.nara.org.br/servicos/ntp/servidor-ntp-para-linux" title="Servidor NTP para Linux" target="_blank">Servidor NTP para Linux</a>;</li>
<li>
<a href="http://www.debianadmin.com/ntp-server-and-client-configuration-in-debian.html" title="NTP Server and Client Configuration in debian" target="_blank">NTP Server and Client Configuration in debian</a>;</li>
<li>
<a href="http://dshowgirl.highend3d.com/2008/01/09/configuring-ntp-on-a-linux-server/" title="Configuring NTP on a LINUX Server" target="_blank">Configuring NTP on a LINUX Server</a>;</li>
<li>
<a href="http://support.ntp.org/bin/view/Support/TroubleshootingNTP" title="Troubleshooting NTP" target="_blank">Troubleshooting NTP</a>;</li>
<li>
<a href="http://www.gsp.com/cgi-bin/man.cgi?section=8&amp;amp;topic=ntpq#4" title="ntpq - standard NTP query program" target="_blank">ntpq – standard NTP query program</a>;</li>
<li>man ntp, man ntpq, man ntp.conf, man ntp.drift.</li>
</ul>
Posted in Redes Tagged: 9.04, configuração, configurando, debian, debian 5, debian lenny, horário, howto, instalação, instalando, jaunty, linux, net time, ntp, ntpd, ntpq, Redes, relógio, servidor, sincronização, tally codes, tutorial, ubuntu, ubuntu jaunty, windows, windows 2003 server, windows vista, windows xp <a href="http://feeds.wordpress.com/1.0/gocomments/andreferraro.wordpress.com/325/"><img src="http://feeds.wordpress.com/1.0/comments/andreferraro.wordpress.com/325/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godelicious/andreferraro.wordpress.com/325/"><img src="http://feeds.wordpress.com/1.0/delicious/andreferraro.wordpress.com/325/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/gostumble/andreferraro.wordpress.com/325/"><img src="http://feeds.wordpress.com/1.0/stumble/andreferraro.wordpress.com/325/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godigg/andreferraro.wordpress.com/325/"><img src="http://feeds.wordpress.com/1.0/digg/andreferraro.wordpress.com/325/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/goreddit/andreferraro.wordpress.com/325/"><img src="http://feeds.wordpress.com/1.0/reddit/andreferraro.wordpress.com/325/" border="0" alt=""></a> <img src="http://stats.wordpress.com/b.gif?host=andreferraro.wordpress.com&amp;blog=6980461&amp;post=325&amp;subd=andreferraro&amp;ref=&amp;feed=1" border="0" alt="">
</div><br style="clear:both"/></div></div>
<hr class='sep-posts'/>
<div id="post-3178" class="blog-post position-3 odd-post"><div class="odd-post-inner blog-post-inner"><h1 class="title"><a href="http://softwarelivre.org/andre-ferraro/blog/linux-screen-gerenciador-de-janelas-no-terminal.-instalacao-e-dicas-para-debian-lenny-debian-5.0-e-ubuntu-jaunty-ubuntu-9.04">Linux: Screen, gerenciador de janelas no terminal. Instalação e dicas para Debian Lenny (Debian 5.0) e Ubuntu Jaunty (Ubuntu 9.04)</a></h1><span class="publishing-info"><span class="date">6 de Maio de 2009, 0:00</span><span class="author">, por Software Livre Brasil</span><span class="comments"> - <a href="/andre-ferraro/blog/linux-screen-gerenciador-de-janelas-no-terminal.-instalacao-e-dicas-para-debian-lenny-debian-5.0-e-ubuntu-jaunty-ubuntu-9.04#comments_list"><span class='comment-count hide'>1</span><span class='comment-count-write-out'>Um comentário</span></a></span></span><div class="snap_preview">
<br><div class="wp-caption alignleft" style="width: 225px;">
<img class="size-full wp-image-314" title="Pimp my Bash" src="http://andreferraro.files.wordpress.com/2009/05/pimp-my-bash.jpg?w=215&amp;#038;h=300" height="300" alt="Pimp my Bash" width="215"><p class="wp-caption-text">Pimp my Bash: Ubuntu e Debian</p>
</div>
<p>Todo administrador de rede ou sistemas sabe que servidores Linux e ambientes gráficos não combinam. Muitos preferem utilizar apenas o terminal, seja por performance, espaço em disco, ou ainda, ferramentas instaladas no ambiente gráfico que nunca serão utilizadas. Porém, temos que ter em mãos alguns artifícios que facilitem nosso dia-a-dia, então memorizamos, quase que por <em>osmose</em>, vários comandos do bash, como grep, awk, sed, etc… mas como podemos melhorar ainda mais a produtividade utilizando apenas o terminal? A resposta para essa questão é simples, utilizar um <strong>gerenciador de janelas</strong>. Sim! O <a href="http://www.gnu.org/software/screen/" title="GNU Screen" target="_blank"><strong>screen</strong></a> é um pequeno e poderoso utilitário que tem como principal recurso o gerenciamento de múltiplas sessões de terminal.<span></span></p>
<p>Antes de começar a “falar” sobre o <em>screen</em>, quero lembrar de um outro <em>post</em> sobre <a href="http://andreferraro.wordpress.com/2009/04/07/linux-alterando-a-resolucao-do-terminal-via-grub-ou-lilo/" title=" Linux: Alterando a resolução do terminal via GRUB ou Lilo"><strong>alteração de resolução do terminal via GRUB ou lilo</strong></a>. Vale a dica.</p>
<h4>Screen, o gerenciador de janelas</h4>
<p>Baseado em texto e <em>fullscreen</em> (todo o espaço da tela), o <em>screen</em> possibilita, com apenas uma tela de terminal, que muitas vezes acessamos via PuTTY, gerenciarmos múltiplas sessões através de um conceito parecido com janelas.</p>
<p>Na minha opinião, as principais vantagens em utilizar screen são:</p>
<ul>
<li>executar várias janelas ao mesmo tempo;</li>
<li>possibilidade de dividir a tela em duas áreas 	de trabalho (split);</li>
<li>salvar uma sessão para voltar a utiliza-lá;</li>
<li>copiar o conteúdo de uma janela para outra.</li>
</ul>
<p>Essas características fizeram do <em>screen</em> um dos utilitários fundamentais para qualquer administrador. Eu, por exemplo, sempre deixo uma janela para visualizar o <em>log</em> da aplicação que estou trabalhando no momento.</p>
<h4>Instalando o screen</h4>
<p>No <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>) para servidor já tem o <em>screen</em> instalado como padrão, porém não faz parte da instalação padrão do <strong>Debian Lenny</strong> (<em>Debian 5.0</em>), então para instalarmos, vamos utilizar o <em>apt</em>. Antes é sempre bom atualizarmos a lista de repositórios e depois faremos a instalação do <em>screen</em>:</p>
<p><code># apt-get update</code><br>
<code># apt-get install screen</code></p>
<p>Para iniciar o screen, tanto no Ubuntu quanto no Debian, basta utilizar o comando <em>screen</em>:</p>
<p><code># screen</code></p>
<h4>Principais comandos</h4>
<p>Lista dos principais comandos utilizados dentro do <em>screen</em>, funciona tanto no <em>Debian</em> quanto no <em>Ubuntu</em>, pois são características do utilitário:</p>
<table border="0">

<tr>
<td><strong>Comando</strong></td>
<td><strong>Função</strong></td>
</tr>
<tr>
<td>CTRL+a, c</td>
<td>Cria nova janela</td>
</tr>
<tr>
<td>CTRL+a, k</td>
<td>Fecha uma janela</td>
</tr>
<tr>
<td>CTRL+a, &lt;espaço&gt;</td>
<td>Vai para a próxima janela</td>
</tr>
<tr>
<td>CTRL+a, A</td>
<td>Define um nome (título) para a janela</td>
</tr>
<tr>
<td>CTRL+a, w</td>
<td>Visualiza quais são as janelas existentes</td>
</tr>
<tr>
<td>CTRL+a, C</td>
<td>Limpa a tela (similiar ao comando <em>clear</em>)</td>
</tr>
<tr>
<td>CTRL+a, S</td>
<td>Divide a janela (<em>split</em>) horizontalmente</td>
</tr>
<tr>
<td>CTRL+a, TAB</td>
<td>Navega entre <em>splits</em>
</td>
</tr>
<tr>
<td>CTRL+a, X</td>
<td>Remove <em>split</em>
</td>
</tr>
<tr>
<td>CTRL+a, : split -v</td>
<td>Divide a janela (split) verticalmente</td>
</tr>
<tr>
<td>CTRL+a, &lt;número da janela&gt;</td>
<td>Navega entre janelas</td>
</tr>
<tr>
<td>CTRL+a, d</td>
<td>Salva sessão e volta para o <em>bash</em> sem o <em>screen</em>
</td>
</tr>
<tr>
<td>screen -ls</td>
<td>Lista sessões rodando screen</td>
</tr>
<tr>
<td>screen -r &lt;número da sessão&gt;</td>
<td>Retorna a uma sessão salva (sem o número para retornar a última sessão salva)</td>
</tr>
<tr>
<td>CTRL+a, [</td>
<td>Copia conteúdo da janela</td>
</tr>
<tr>
<td>CTRL+a, ]</td>
<td>Cola conteúdo na janela</td>
</tr>
<tr>
<td>CTRL+C, b</td>
<td>Rola a página para cima</td>
</tr>
<tr>
<td>CTRL+C, f</td>
<td>Rola a página para baixo</td>
</tr>
<tr>
<td>CTRL+a, x</td>
<td>Trava a janela, necessitando do login e senha para voltar a usa-lá</td>
</tr>
<tr>
<td>CTRL+a, ?</td>
<td>Visualiza os atalhos disponíveis</td>
</tr>

</table>
<p><strong>Dica:</strong> Para copiar um texto, utilize CTRL+a, [ e selecione utilizando a tecla de espaço. Após selecionar o texto, então tecle &lt;ENTER&gt;, vá para a janela onde deseja colar o texto com CTRL+a, &lt;número da janela&gt; e cole o texto com CTRL+a, ].</p>
<h5><strong>Utilizando os sub-comandos hardstatus e caption</strong></h5>
<p>Os dois comandos gerenciam a barra de status do <em>screen</em>, porém o <strong>caption</strong> é indicado para ser utilizado quando trabalhamos com várias janelas, enquanto o <strong>hardstatus</strong> para mensagens de atividades. Veja mais consultando o manual do screen. Basta digitar <em>man screen</em>.</p>
<p>Para utilizar os sub-comandos pressione <em>CTRL+a, :</em> e digite a linha desejada, por exemplo <em>hardstatus alwayslastline %c</em>. Este comando exibe a hora atual.</p>
<p>São várias as utilizações dos dois comandos, podemos mostrar dados como o nome do computador onde estamos logados, o horário, a data, a listagem de janelas, etc. Abaixo segue alguns exemplos que podem melhorar ainda mais a utilização do <em>screen</em> (inclusive trabalhando com cores):</p>
<table border="0">

<tr>
<td><strong>Sub-comando</strong></td>
<td><strong>Descrição</strong></td>
</tr>
<tr>
<td>caption always “%{gk}%w”</td>
<td>Mostra a listagem de janelas em verde.</td>
</tr>
<tr>
<td>hardstatus alwayslastline “%{bk}%c”</td>
<td>Mostra o relógio em azul.</td>
</tr>
<tr>
<td>caption always “%{+b rk}%H%{gk} |%c %{yk}%d.%m.%Y | %72=Load: %l %{wk}”</td>
<td>Exibe o nome da máquina em vermelho, a hora em verde, a data em amarelo e status do sistema também em amarelo.</td>
</tr>
<tr>
<td>hardstatus alwayslastline “%?%{yk}%-Lw%?%{wb}%n*%f %t%?(%u)%?%?%{yk}%+Lw%?”</td>
<td>Exibe o título da janela atual em azul e branco e as demais janelas existentes em verde e preto.</td>
</tr>

</table>
<p>O importante dos exemplos acima é entendermos que, com esses dois sub-comandos, podemos facilitar a visualização de informações do sistema, inclusive com cores específicas.</p>
<p>Principais parâmetros:</p>
<table border="0" style="height: 144px;" width="458">

<tr>
<td>c</td>
<td>Hora atual no formato24 horas</td>
</tr>
<tr>
<td>D</td>
<td>Dia da semana</td>
</tr>
<tr>
<td>H</td>
<td>Nome da máquina</td>
</tr>
<tr>
<td>M</td>
<td>Nome do mês</td>
</tr>
<tr>
<td>n</td>
<td>Número da janela</td>
</tr>
<tr>
<td>t</td>
<td>Título da janela</td>
</tr>
<tr>
<td>w</td>
<td>Todas as janelas e seus números</td>
</tr>

</table>
<p>Lista das cores suportadas pelo screen:</p>
<table border="0" style="height: 104px;" width="389">

<tr>
<td>k</td>
<td>Preto</td>
</tr>
<tr>
<td>r</td>
<td>Vermelho</td>
</tr>
<tr>
<td>g</td>
<td>Verde</td>
</tr>
<tr>
<td>y</td>
<td>Amarelo</td>
</tr>
<tr>
<td>b</td>
<td>Azul</td>
</tr>

</table>
<p>Consulte o manual do <strong>screen</strong> (<em>man screen</em>) para mais opções.</p>
<p><strong>Importante:</strong> Todos os comandos funcionam perfeitamente no <em>PuTTY</em>.</p>
<h4>Pimp my Bash</h4>
<p>Nos itens anteriores deste <em>post</em> foi possível tomar contato com alguns sub-comandos de visualização de status inclusive com cores, porém é óbvio que a tarefa de configurar o <em>screen</em> pode ser um tanto morosa e alguns, que é o meu caso, podem não ter tanta habilidade com combinações de cores. Mas isso também pode ser melhorado. Graças ao pacote <strong>screen-profiles</strong> e <strong>screen-profiles-extras</strong> é possível irmos muito além na questão visualização. Esses dois pacotes foram criados originalmente por Dustin Kirkland, que é um dos desenvolvedores da equipe do <strong>Ubuntu</strong>, e com certeza trouxeram muitos avanços para o <em>screen</em>, inclusive podendo utilizar teclas de atalho e configurações mais facilmente.</p>
<div class="wp-caption aligncenter" style="width: 440px;">
<a href="http://andreferraro.files.wordpress.com/2009/05/pimp-my-bash-debian-screen.png"><img class="size-medium wp-image-323" title="Pimp my Bash: Gerenciando janelas no Debian" src="http://andreferraro.files.wordpress.com/2009/05/pimp-my-bash-debian-screen.png?w=430&amp;#038;h=323" height="323" alt="Pimp my Bash: Gerenciando janelas no Debian" width="430"></a><p class="wp-caption-text">Pimp my Bash: Gerenciando janelas no Debian</p>
</div>
<p>O pacote <strong>screen-profiles</strong> já vem instalado no <strong>Ubuntu Jaunty</strong> (<em>Ubuntu 9.04</em>) e é facilmente notado quando executamos o programa <em>screen</em> pela primeira vez, com isso podemos escolher o padrão de cores. Caso queira mais cores para seu <em>screen</em> no <em>Ubuntu</em>, basta instalar o pacote de extras com o comando:</p>
<p><code># apt-get install screen-profiles-extras</code></p>
<p>Após a instalação é possível selecionar um novo padrão de cores de duas maneiras, uma é através da tecla <strong>F9</strong> do teclado e depois selecionar a opção <strong>Change screen profile</strong> e escolher entre vários novos padrões de cores. Outra forma é através do comando:</p>
<p><code># screen-profiles</code></p>
<p>E também escolher a opção  <strong>Change screen profile</strong>.</p>
<p>Já no <strong>Debian</strong> a estória é outra, pois ainda não existem os pacotes <strong>screen-profiles</strong> e <strong>screen-profiles-extras</strong> nos repositórios. Então vamos utilizar o pacote do <em>Ubuntu</em> mesmo!</p>
<p>A primeira coisa a fazer é instalarmos o pacote <strong>python-newt</strong> que é um módulo para construção de interfaces em <em>Python</em>.</p>
<p><code># apt-get install python-newt</code></p>
<p>Agora vamos fazer o download do pacote <strong>screen-profiles</strong> de um repositório do <em>Ubuntu</em>, eu baixei da <strong>Unicamp</strong> no endereço: <a href="http://www.las.ic.unicamp.br/pub/ubuntu/pool/main/s/screen-profiles/screen-profiles_1.54-0ubuntu1_all.deb" target="_blank">http://www.las.ic.unicamp.br/pub/ubuntu/pool/main/s/screen-profiles/screen-profiles_1.54-0ubuntu1_all.deb</a>. Utilize o comando:</p>
<p><code># wget -c  http://www.las.ic.unicamp.br/pub/ubuntu/pool/main/s/screen-profiles/screen-profiles_1.54-0ubuntu1_all.deb</code></p>
<p>Após o download, basta instalar o pacote com o comando:</p>
<p><code># dpkg -i screen-profiles_1.54-0ubuntu1_all.deb</code></p>
<p>Após a instalação vamos acessar as opções do <em>screen-profiles</em> com o comando:</p>
<p><code># screen-profiles</code></p>
<p>Agora selecione o esquema de cores na opção <strong>Change screen profile</strong>. Reinicialize o <em>screen</em>.</p>
<p>Podemos ainda instalar o pacote de extras, para isso vamos fazer o download do pacote com o comando:</p>
<p><code># wget -c http://www.las.ic.unicamp.br/pub/ubuntu/pool/universe/s/screen-profiles/screen-profiles-extras_1.54-0ubuntu1_all.deb</code></p>
<p>Agora vamos instalá-lo:</p>
<p><code># dpkg -i screen-profiles-extras_1.54-0ubuntu1_all.deb</code></p>
<p>Após instalado, vamos novamente utilizar o comando <strong>screen-profiles</strong>.</p>
<p>Uma das vantagens do pacote <strong>screen-profiles</strong> é possibilitar maior facilidade na utilização do <em>screen</em> e parte disso vem do menu.</p>
<div class="wp-caption aligncenter" style="width: 440px;">
<a href="http://andreferraro.files.wordpress.com/2009/05/screen-profiles-ubuntu.png"><img class="size-medium wp-image-317" title="Screen-profiles no Ubuntu" src="http://andreferraro.files.wordpress.com/2009/05/screen-profiles-ubuntu.png?w=430&amp;#038;h=238" height="238" alt="Screen-profiles no Ubuntu" width="430"></a><p class="wp-caption-text">Screen-profiles no Ubuntu</p>
</div>
<p>Dentro do menu é possível não só alterar o padrão de cores, mas também é possivel criar janelas com utilização específica, como por exemplo, podemos criar uma janela específica para logs. Para isso acesse a opção <strong>Create default window(s) </strong>e então marque a opção <strong>System log</strong>. Para deixar uma janela com as atividades dos processos, basta marcar <strong>System activity</strong> ou para ver informações de disco e memória escolha a opção <strong>Disk and ram usage</strong> e por fim confirme a criação da janela no item <strong>Apply</strong>.</p>
<p>Outra função extremamente interessante é a visualização de várias informações na barra de status. Para alterar, aumentarmos ou diminuirmos os itens de status, basta acessar a opção <strong>Toggle status notifications</strong> no menu principal e marcar as opções que desejar e depois confirmar no item <strong>Apply</strong>.</p>
<p>Por fim, uma opção útil é instalar o screen como padrão, para isso escolha a opção <strong>Install screen by default at login</strong> no menu principal.</p>
<div class="wp-caption alignleft" style="width: 160px;">
<a href="http://andreferraro.files.wordpress.com/2009/05/pimp-my-bash-02.png"><img class="size-thumbnail wp-image-313" title="Screen e ls --color no Debian" src="http://andreferraro.files.wordpress.com/2009/05/pimp-my-bash-02.png?w=150&amp;#038;h=96" height="96" alt="Screen e ls --color no Debian" width="150"></a><p class="wp-caption-text">Screen e ls --color no Debian</p>
</div>
<p>Dica: além de todas as possibilidades que o <em>screen</em> e os pacotes auxiliares <em>screen-profiles</em> e <em>screen-profiles-extras</em>, eu também configuro no <strong>Debian</strong> algo que é padrão no <em>Ubuntu</em> que é a utilização de cores na listagem de arquivos e diretórios. No <em>Debian</em>, caso queira visualizar os arquivos e diretórios com diferenciação de cores, você precisará utilizar <strong>–color</strong> após o comando <strong>ls</strong>, mas é possível padronizar a utilização de cores.</p>
<p>Vamos editar o arquivo /root/.bashrc com o comando:</p>
<p><code># vi /root/.bashrc</code></p>
<p>Agora desmarque as seguintes linhas:</p>
<p><code>export LS_OPTIONS='--color=auto'</code><br>
<code>eval "`dircolors`"</code><br>
<code>alias ls='ls $LS_OPTIONS'</code><br>
<code>alias ll='ls $LS_OPTIONS -l'</code><br>
<code>alias l='ls $LS_OPTIONS -lA'</code></p>
<p>Salve o arquivo com <em>:wq!</em>.</p>
<p>Acho que com essas informações, dicas, instalações e configurações podemos ter um terminal mais útil e prático no dia-a-dia.</p>
<h4>Fontes e Referências</h4>
<ul>
<li>
<a href="http://www.gnu.org/software/screen/" title="GNU Screen" target="_blank">GNU Screen</a>;</li>
<li>
<a href="http://blog.dustinkirkland.com/2008/12/ubuntu-server-includes-window-manager.html" title="The Ubuntu Server already includes a Window Manager?" target="_blank">The Ubuntu Server already includes a Window Manager?</a>;</li>
<li>
<a href="http://stoa.usp.br/walrus/weblog/9550.html" title="Walrus :: Gerenciador de janelas... para terminais" target="_blank">Walrus :: Gerenciador de janelas… para terminais</a>;</li>
<li>
<a href="http://www.debian-administration.org/articles/560" title="An introduction to the visual features of GNU Screen" target="_blank">An introduction to the visual features of GNU Screen</a>;</li>
<li>
<a href="https://help.ubuntu.com/9.04/serverguide/C/screen-profiles.html" title="Screen Profiles" target="_blank">Screen Profiles</a>;</li>
<li>
<a href="https://launchpad.net/screen-profiles" title="Screen Profiles and Profile-Selector in Lauchpad" target="_blank">Screen Profiles and Profile-Selector in Lauchpad</a>;</li>
<li>
<a href="http://arstechnica.com/open-source/news/2009/04/ubuntu-brings-advanced-screen-features-to-the-masses.ars" title="Ubuntu brings advanced Screen features to the masses" target="_blank">Ubuntu brings advanced Screen features to the masses</a>;</li>
<li>man screen, man screen-profiles</li>
</ul>
Posted in Redes Tagged: 9.04, bash, configuração, configurando, debian, debian 5, debian lenny, gerenciador de janelas, howto, instalação, instalando, jaunty, linux, pimp, pimp my bash, putty, Redes, screen, screen-profiles, screen-profiles-extras, terminal, tutorial, ubuntu, ubuntu 9.04, ubuntu jaunty <a href="http://feeds.wordpress.com/1.0/gocomments/andreferraro.wordpress.com/316/"><img src="http://feeds.wordpress.com/1.0/comments/andreferraro.wordpress.com/316/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godelicious/andreferraro.wordpress.com/316/"><img src="http://feeds.wordpress.com/1.0/delicious/andreferraro.wordpress.com/316/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/gostumble/andreferraro.wordpress.com/316/"><img src="http://feeds.wordpress.com/1.0/stumble/andreferraro.wordpress.com/316/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godigg/andreferraro.wordpress.com/316/"><img src="http://feeds.wordpress.com/1.0/digg/andreferraro.wordpress.com/316/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/goreddit/andreferraro.wordpress.com/316/"><img src="http://feeds.wordpress.com/1.0/reddit/andreferraro.wordpress.com/316/" border="0" alt=""></a> <img src="http://stats.wordpress.com/b.gif?host=andreferraro.wordpress.com&amp;blog=6980461&amp;post=316&amp;subd=andreferraro&amp;ref=&amp;feed=1" border="0" alt="">
</div><br style="clear:both"/></div></div>
<hr class='sep-posts'/>
<div id="post-3177" class="blog-post position-4 even-post"><div class="even-post-inner blog-post-inner"><h1 class="title"><a href="http://softwarelivre.org/andre-ferraro/blog/linux-corringindo-falhas-e-solucionando-problemas-de-raid-no-ubuntu-intrepid-ubuntu-8.10">Linux: Corringindo falhas e solucionando problemas de RAID no Ubuntu Intrepid (Ubuntu 8.10)</a></h1><span class="publishing-info"><span class="date">30 de Abril de 2009, 0:00</span><span class="author">, por Software Livre Brasil</span><span class="comments"> - <a href="/andre-ferraro/blog/linux-corringindo-falhas-e-solucionando-problemas-de-raid-no-ubuntu-intrepid-ubuntu-8.10#comments_list"><span class='comment-count hide'>0</span><span class='comment-count-write-out'>sem comentários ainda</span></a></span></span><div class="snap_preview">
<br><div class="wp-caption alignleft" style="width: 225px;">
<a href="http://andreferraro.wordpress.com/2009/04/30/linux-corringindo-falhas-solucionando-problemas-raid-ubuntu-intrepid-810/ubuntu-raid-solucao-problem/"><img title="Solução de problemas e simulação de falhas no RAID" class="size-full wp-image-268" src="http://andreferraro.files.wordpress.com/2009/04/ubuntu-raid-solucao-problem.jpg?w=215&amp;#038;h=300" height="300" alt="Solução de problemas e simulação de falhas no RAID" width="215"></a><p class="wp-caption-text">Solução de problemas e simulação de falhas no RAID</p>
</div>
<p>Esta é parte mais útil e divertida de se trabalhar com <em>RAID</em>, digo útil, por que se você tiver problemas com seu <em>RAID</em>, com certeza essas informações poderão lhe ajudar, caso você não tenha problema, então pode simular problemas e verificar como o sistema se comporta.</p>
<p>Resolvi utilizar três cenários para demonstrar as possibilidades de manutenção de um array, imaginando que você queira simular uma falha, ou adicionar mais espaço à máquina, ou ainda, um dos discos tenha parado de funcionar.<span></span></p>
<h4>Cenário 1: Simulando falhas.</h4>
<p>Vamos imaginar que você não quer desligar o disco, ou seja, não quer remover o disco da máquina para testar como seu <em>RAID</em> se comportaria, mas quer saber qual vai ser esse comportamento em caso de falhas ou queima do disco, para isso é possível simular o problema, com um comando do utilitário mdadm, propriamente para esta tarefa.</p>
<p>Então para simular uma falha de disco, digite o comando abaixo:</p>
<p><code># mdadm --manage --set-fault /dev/md0 /dev/sdc1</code></p>
<p>Este comando simulará que o terceiro disco, ou seja, o sdc1 parou de funcionar no <em>array</em> (<strong>md0</strong>).</p>
<p>Para verificar os detalhes de como seu <em>array</em> está se comportando, basta executar o comando:</p>
<p><code># mdadm --detail /dev/md0</code></p>
<p>Veja o resultado abaixo:</p>
<p><code>/dev/md0:<br>
Version : 00.90<br>
Creation Time : Tue Apr 28 06:38:18 2009<br>
Raid Level : raid10<br>
Array Size : 16771584 (15.99 GiB 17.17 GB)<br>
Used Dev Size : 8385792 (8.00 GiB 8.59 GB)<br>
Raid Devices : 4<br>
Total Devices : 4<br>
Preferred Minor : 0<br>
Persistence : Superblock is persistent<br>
Update Time : Thu Apr 30 04:01:14 2009<br>
<span style="text-decoration: underline;"><strong>State : clean, degraded</strong></span><br>
<span style="text-decoration: underline;"><strong>Active Devices : 3</strong></span><br>
<span style="text-decoration: underline;"><strong>Working Devices : 3</strong></span><br>
<span style="text-decoration: underline;"><strong>Failed Devices : 1</strong></span><br>
Spare Devices : 0<br>
Layout : near=2, far=1<br>
Chunk Size : 64K<br>
UUID : c4456b47:e8cb8a5b:e368bf24:bd0fce41<br>
Events : 0.12<br>
Number   Major   Minor   RaidDevice State<br>
0       8        1        0      active sync   /dev/sda1<br>
1       8       17        1      active sync   /dev/sdb1<br>
<span style="text-decoration: underline;"><strong>2       0        0        2      removed</strong></span><br>
3       8       49        3      active sync   /dev/sdd1<br>
<span style="text-decoration: underline;"><strong>4       8       33        -      faulty spare   /dev/sdc1</strong></span></code></p>
<p>Repare, nas linhas em negrito e sublinhadas, que o status, apesar de funcional, agora está em modo <strong>degrade</strong> (qualidade inferior). Repare também que só existem três discos ativos trabalhando e um está como falhado. Nas últimas três linhas, veja que é exibido que o disco foi removido e que está com falha.</p>
<p>Veja que se verificar o arquivo /proc/mdstat, a resposta será a mesma.</p>
<p><code>Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]<br>
md0 : active raid10 sdb1[1] sdd1[3] <span style="text-decoration: underline;"><strong>sdc1[4](F)</strong></span> sda1[0]<br>
16771584 blocks 64K chunks 2 near-copies [4/3] [UU_U]</code></p>
<p>Note o<em><strong> (F) </strong></em>na frente do dispositivo <strong>sdc1</strong>.</p>
<p>Para voltarmos ao funcionamento normal, ou seja, com os quatro discos, então é necessário fazermos a “remoção” do disco, como se fosse um disco <em>hot-swap</em> (discos que permitem a troca sem a necessidade de desligamento da máquina):</p>
<p><code># mdadm /dev/md0 -r /dev/sdc1</code></p>
<p>Se você verificar o status do seu array, irá perceber que agora não há menção a nenhum disco com falha, isso ocorre por que “removemos” o disco com problema.</p>
<p>Agora precisamos “incluir” um novo disco ao <em>array</em>, para que nosso sistema volte a trabalhar perfeitamente. Para isso vamos executar o comando:</p>
<p><code># mdadm /dev/md0 -a /dev/sc1</code></p>
<p>Caso queira ver o status do “retorno” do disco que simulamos como falhado, basta visualizar o arquivo <em>/proc/mdstat</em>:</p>
<p><code># cat /proc/mdstat</code></p>
<p>A saída será semelhante a esta:</p>
<p><code>Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]<br>
md0 : active raid10 sdc1[4] sdb1[1] sdd1[3] sda1[0]<br>
16771584 blocks 64K chunks 2 near-copies [4/3] [UU_U]<br>
<strong>[====&gt;................]  recovery = 22.0% (1852160/8385792) finish=0.5min speed=185216K/sec</strong></code></p>
<p>Agora seu <em>RAID</em> está em processo de recuperação e ao final você poderá ver os detalhes do <em>array</em>.</p>
<p>Legal, deu pra testar o funcionamento do nosso <em>array</em> caso algum disco falhe, é possível fazer essa simulação com dois discos sem que seu sistema pare de funcionar.</p>
<h4>Cenário 2: Preciso de mais espaço, então quero adicionar mais discos no meu <em>array</em>.</h4>
<p>Hm… primeira coisa a saber, <em>RAID10 </em>não é linear, ou seja, agente monta primeiro o espelhamento (<em>mirroring</em>) e depois o fracionamento (<em>stripping</em>)… então não é possível aumentarmos nosso <em>array</em> quando utilizamos o nível 10. Para testar o que estou afirmando, caso você tenha mais quatro discos particionados, então execute este comando (caso você tenha mais quatro discos):</p>
<p><code># mdadm --grow /dev/md0 --add /dev/sde1 /dev/sdf1 /dev/sdg1 /dev/sdh1</code></p>
<p>E a mensagem dirá que não é possível adicionar dispositivos a um <em>array</em> não linear.</p>
<p>A solução é criar um novo <em>array</em> para aumentar a capacidade de armazenamento da sua máquina.</p>
<p>Caso você adicione mais discos ao <em>array</em>, estes funcionarão como <em>spares</em> (estepes) e não aumentarão a quantidade de espaço disponível no <em>array</em>. Que pena, mas é verdadeiro por uma questão lógica.</p>
<p>Caso queira ter seu <em>spare </em>(disco reserva ou estepe) funcionando, você deverá configurar a partição de <em>RAID </em>e formatá-la como <em>ext3</em>, como já fizemos anteriormente, e por fim executar o comando de inclusão do dispositivo no <em>array</em>:</p>
<p><code># mdadm --add /dev/md0 /dev/sde1</code></p>
<p>O resultado é que o novo disco não entrará em uso, nem como espelho e nem como incremento de espaço e se tornará um <em>spare</em>. <strong>Spare </strong>(disco reserva). Veja como ficou o array após a inclusão do quinto disco:</p>
<p><code>/dev/md0:<br>
Version : 00.90<br>
Creation Time : Wed Apr 22 20:41:00 2009<br>
Raid Level : raid10<br>
Array Size : 15791616 (15.06 GiB 16.17 GB)<br>
Used Dev Size : 7895808 (7.53 GiB 8.09 GB)<br>
Raid Devices : 4<br>
Total Devices : 5<br>
Preferred Minor : 0<br>
Persistence : Superblock is persistent<br>
Update Time : Sat Apr 25 20:30:01 2009<br>
State : clean<br>
Active Devices : 4<br>
<span style="text-decoration: underline;"><strong>Working Devices : 5</strong></span><br>
Failed Devices : 0<br>
Spare Devices : 1<br>
Layout : near=2, far=1<br>
Chunk Size : 64K<br>
UUID : 7d45dd9f:9c1c3041:e368bf24:bd0fce41 (local to host ubuntu)<br>
Events : 0.132<br>
Number   Major   Minor   RaidDevice State<br>
0       8        3        0      active sync   /dev/sda3<br>
1       8       17        1      active sync   /dev/sdb1<br>
2       8       33        2      active sync   /dev/sdc1<br>
3       8       49        3      active sync   /dev/sdd1<br>
<strong> <span style="text-decoration: underline;">4       8       65        -      spare   /dev/sde1</span></strong></code></p>
<p>Nas linhas em negrito e sublinhadas, você pode ver que o disco <strong>spare</strong> está lá.</p>
<p>Apesar de não adicionarmos mais espaço no <em>array</em>, o <strong>spare</strong> funciona como um pneu de estepe e caso algum disco participante do <em>array</em> venha a queimar (ou parar de funcionar), o <em>spare</em> automaticamente assume seu lugar! Mais segurança ainda!</p>
<h4>Cenário 3: Um dos discos do <em>array</em> queimou! E agora?</h4>
<p>Simulei esse cenário em minha máquina virtual. Simplesmente desliguei a máquina virtual e removi (<em>deletei</em>) um disco. Isso mesmo! Apaguei o <strong>sdc</strong>, ou seja o terceiro disco. Simulei como se um disco sumisse do computador, seja por falha ou por queima, ou ainda, por remoção física da máquina, então liguei o Ubuntu 8.10 e fui informado que um disco tinha falhado e que eu tinha duas opções. A primeira opção era entrar em modo de recuperação e a outra era iniciar o sistema operacional normalmente, porém em modo <strong>degraded</strong> (algo como “em baixa qualidade”).</p>
<div class="wp-caption aligncenter" style="width: 440px;">
<a href="http://andreferraro.files.wordpress.com/2009/04/raid-degraded-ubuntu.gif"><img title="RAID: Modo degraded" class="size-medium wp-image-279" src="http://andreferraro.files.wordpress.com/2009/04/raid-degraded-ubuntu.gif?w=430&amp;#038;h=258" height="258" alt="RAID: Modo degraded" width="430"></a><p class="wp-caption-text">RAID: Modo degraded</p>
</div>
<p>Escolhi entrar em modo <em>degraded</em> e o sistema operacional funcionou sem problemas, porém precisava adicionar um disco novamente e simular a recuperação, então desliguei a máquina virtual, criei um novo disco com a mesma capacidade e reiniciei a máquina.</p>
<p>Para saber qual o dispositivo inserido basta executar esse comando:</p>
<p><code># ls /dev/sd*</code></p>
<p>E serão exibidos todos os discos <em>SATA</em> e meu disco recém criado estava lá sendo o <strong>sdc</strong>. Sendo assim, basta configurar as partições, formatá-las e por fim adicionar ao <em>array</em>. O primeiro passo é configurar a partição:</p>
<p><code># cfdisk /dev/sdc</code></p>
<p>Crie uma nova partição escolhendo a opção <em>New</em> (nova), digite o tamanho (cuidado para selecionar o tamanho igual ao das demais partições do <em>array</em>), depois escolha o local do disco onde será criada a partição, no meu caso, <em>Beginning</em> (início). Depois vamos definir o tipo como sendo <strong>Linux Raid Autodetect</strong>, então escolha a opção <em>Type</em> (tipo) e digite o código <strong>FD</strong>.</p>
<p>Grave as alterações com o comando <em>Write </em>(escrever – gravar). Agora basta sair do <em>cfdisk</em> e formatar a partição utilizando o comando:</p>
<p><code># mkfs.ext3 /dev/sdc1</code></p>
<p>Depois de formatada, vamos adicionar a partição <em>/dev/sdc1</em> ao <em>array /dev/md0</em> com o comando:</p>
<p><code># mdadm --add /dev/md0 /dev/sdc1</code></p>
<p>Caso você queira monitorar o status da adição desta partição ao array, basta utilizar os comandos:</p>
<p><code># cat /proc/mdstat</code></p>
<p>A saída desse comando deverá ser como esta:</p>
<p><code>Personalities : [linear] [multipath] [raid0] [raid1] [raid6] [raid5] [raid4] [raid10]<br>
md0 : active raid10 sdc1[4] sda3[0] sdd1[3] sdb1[1]<br>
15791616 blocks 64K chunks 2 near-copies [4/3] [UU_U]<br>
<strong>[===&gt;.................]  recovery = 15.0% (1191744/7895808) finish=1.1min speed=99312K/sec</strong><br>
unused devices: &lt;none&gt;</code></p>
<p>Ou ainda, você poderá ver o status utilizando o comando abaixo:</p>
<p><code># mdadm --details /dev/md0</code></p>
<p>A saída deverá ser como esta:</p>
<p><code>/dev/md0:<br>
Version : 00.90<br>
Creation Time : Wed Apr 22 20:41:00 2009<br>
Raid Level : raid10<br>
Array Size : 15791616 (15.06 GiB 16.17 GB)<br>
Used Dev Size : 7895808 (7.53 GiB 8.09 GB)<br>
Raid Devices : 4<br>
Total Devices : 4<br>
Preferred Minor : 0<br>
Persistence : Superblock is persistent<br>
Update Time : Sat Apr 25 11:13:07 2009<br>
<span style="text-decoration: underline;"><strong>State : clean, degraded, recovering</strong></span><br>
Active Devices : 3<br>
Working Devices : 4<br>
Failed Devices : 0<br>
Spare Devices : 1<br>
Layout : near=2, far=1<br>
Chunk Size : 64K<br>
<span style="text-decoration: underline;"><strong>Rebuild Status : 91% complete</strong></span><br>
UUID : 7d45dd9f:9c1c3041:e368bf24:bd0fce41 (local to host ubuntu)<br>
Events : 0.124<br>
Number   Major   Minor   RaidDevice State<br>
0       8        3        0      active sync   /dev/sda3<br>
1       8       17        1      active sync   /dev/sdb1<br>
<span style="text-decoration: underline;"><strong>4       8       33        2      spare rebuilding   /dev/sdc1</strong></span><br>
3       8       49        3      active sync   /dev/sdd1</code></p>
<p>Repare que as informações, em negrito e sublinhadas, são referentes ao processo de adição da partição.</p>
<p>Após o processo finalizado, seu sistema operacional estará funcionando normalmente.</p>
<p>Finaliza aqui a série de <em>posts</em> sobre <strong>RAID</strong>. Acho que deu pra falar bastante de <strong>RAID</strong>, mas especificamente de <strong>RAID10</strong> (<em>RAID 1+0</em>) , com certeza deu pra acumular bastante conhecimento sobre o assunto. Caso você tenha alguma sugestão de configuração, mande pra mim.</p>
<h4>Veja todos os demais <em>posts </em>sobre RAID</h4>
<ul>
<li><a href="http://andreferraro.wordpress.com/2009/04/25/linux-raid-no-ubuntu-intrepid-ibex-ubuntu-810/" title="Linux: RAID no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">RAID no Ubuntu Intrepid Ibex (Ubuntu 8.10)</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/25/linux-raid-e-niveis-de-raid/" title=" Linux: RAID e níveis de RAID" target="_self">RAID e níveis de RAID</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/26/linux-criando-e-configurando-o-raid-10-via-software-no-ubuntu-intrepid-ibex-ubuntu-810/" title="Linux: Criando e configurando o RAID 10 via software no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">Criando e configurando o RAID 10 no Ubuntu 8.10</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/30/linux-checando-mantendo-monitorando-raid-raid10-ubuntu-intrepid-ibex-810/" title=" Linux: Checando, mantendo e monitorando o RAID (RAID10) no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">Checando, mantendo e monitorando o RAID</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/30/linux-corringindo-falhas-solucionando-problemas-raid-ubuntu-intrepid-810" title="Linux: Corringindo falhas e solucionando problemas de RAID no Ubuntu Intrepid (Ubuntu 8.10)" target="_self">Gerenciando catástrofes</a></li>
</ul>
<h4>Fontes e Referências:</h4>
<ul>
<li><a href="http://www.infowester.com/raid.php" title="Tecnologia RAID" target="_blank">Tecnologia RAID;</a></li>
<li><a href="http://www.clubedohardware.com.br/artigos/651" title="Tudo o que você precisa saber sobre RAID" target="_blank">Tudo o que você precisa saber sobre RAID;</a></li>
<li><a href="http://pt.wikipedia.org/wiki/RAID" title="RAID" target="_blank">RAID;</a></li>
<li><a href="http://en.wikipedia.org/wiki/RAID" title="RAID" target="_blank">RAID;</a></li>
<li><a href="http://www.vivaolinux.com.br/artigo/Criando-dispositivos-RAID-via-software-no-Linux/" title="Criando dispositivos RAID via software no Linux" target="_blank">Criando dispositivos RAID via software no Linux;</a></li>
<li><a href="http://www.amazon.com/Ubuntu-Administration-Network-Professionals-Library/dp/0071598928/ref=sr_11_1?ie=UTF8&amp;amp;qid=1240367025&amp;amp;sr=11-1" title="Livro: Ubuntu Server Administration de Michael Jang" target="_blank">Livro: Ubuntu Server Administration de Michael Jang;</a></li>
<li><a href="http://www.cyberciti.biz/tips/raid5-vs-raid-10-safety-performance.html" title="RAID 5 vs RAID 10: Recommended RAID for safety and performance" target="_blank">RAID 5 vs RAID 10: Recommended RAID for safety and performance;</a></li>
<li><a href="http://weblogs.sqlteam.com/billg/archive/2007/06/18/RAID-10-vs.-RAID-5-Performance.aspx" title="RAID 10 vs. RAID 5 Performance" target="_blank">RAID 10 vs. RAID 5 Performance;</a></li>
<li><a href="http://www.howtoforge.com/install-ubuntu-with-software-raid-10" title="Install Ubuntu With Software RAID 10" target="_blank">Install Ubuntu With Software RAID 10;</a></li>
<li><a href="http://www.linuxplanet.com/linuxplanet/tutorials/6518/1/" title="Manage a Linux RAID 10 Storage Server" target="_blank">Manage a Linux RAID 10 Storage Server;</a></li>
<li><a href="http://tldp.org/HOWTO/Software-RAID-HOWTO-6.html" title="The Software – RAID HOWTO: Detecting, querying and testing" target="_blank">The Software – RAID HOWTO: Detecting, querying and testing;</a></li>
<li><a href="http://br.geocities.com/marcio_katan/tutorial_raid_mandriva.html" title="Tutorial RAID Mandriva" target="_blank">Tutorial RAID Mandriva;</a></li>
<li><a href="http://www.pruonckk.org/wiki/index.php/Linux_Raid_Howto" title="Linux Raid Howto" target="_blank">Linux Raid Howto;</a></li>
<li># man mdadm.conf;</li>
<li><a href="http://localdomain.wordpress.com/2008/07/20/descobrindo-o-uuid-das-particoes/" title="Descobrindo o UUID das Partições" target="_blank">Descobrindo o UUID das Partições;</a></li>
<li><a href="http://nst.sourceforge.net/nst/docs/user/ch14.html" title="Chapter 14. Linux Software RAID" target="_blank">Chapter 14. Linux Software RAID;</a></li>
<li><a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=489257" title="Debian Bug report logs" target="_blank">Debian Bug report logs;</a></li>
<li><a href="http://www.mandrivabrasil.org/site/images/stories/artigos/artigo_RAID_software/tutorial_raid_mandriva.pdf" title="RAID por software no Linux" target="_blank">RAID por software no Linux;</a></li>
<li><a href="http://www.acnc.com/04_01_10.html" title="AC&amp;amp;NC | RAID.edu – RAID Levels" target="_blank">AC&amp;NC | RAID.edu – RAID Levels;</a></li>
<li><a href="http://www.excaliburtech.net/archives/19" title="Useful Mdadm Commands" target="_blank">Useful Mdadm Commands;</a></li>
<li><a href="http://www.novell.com/support/viewContent.do?externalId=7001034&amp;amp;sliceId=1" title="Using mdadm to send e-mail alerts for RAID failures" target="_blank">Using mdadm to send e-mail alerts for RAID failures;</a></li>
<li><a href="http://www.devin.com.br/shell_script/" title="Programando em shell-script" target="_blank">Programando em shell-script;</a></li>
<li><a href="http://en.wikipedia.org/wiki/Redundant_array_of_independent_disks" title="Redundant array of independent disks" target="_blank">Redundant array of independent disks;</a></li>
<li><a href="http://linux-raid.osdl.org/index.php/Detecting,_querying_and_testing" title="Detecting, querying and testing" target="_blank">Detecting, querying and testing.</a></li>
</ul>
Posted in Redes Tagged: 8.10, configuração, configurando, degraded, howto, intrepid, linux, mdadm, RAID, raid 10, raid10, Redes, spare, tutorial, ubuntu, ubuntu 8.10, ubuntu intrepid ibex <a href="http://feeds.wordpress.com/1.0/gocomments/andreferraro.wordpress.com/267/"><img src="http://feeds.wordpress.com/1.0/comments/andreferraro.wordpress.com/267/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godelicious/andreferraro.wordpress.com/267/"><img src="http://feeds.wordpress.com/1.0/delicious/andreferraro.wordpress.com/267/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/gostumble/andreferraro.wordpress.com/267/"><img src="http://feeds.wordpress.com/1.0/stumble/andreferraro.wordpress.com/267/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godigg/andreferraro.wordpress.com/267/"><img src="http://feeds.wordpress.com/1.0/digg/andreferraro.wordpress.com/267/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/goreddit/andreferraro.wordpress.com/267/"><img src="http://feeds.wordpress.com/1.0/reddit/andreferraro.wordpress.com/267/" border="0" alt=""></a> <img src="http://stats.wordpress.com/b.gif?host=andreferraro.wordpress.com&amp;blog=6980461&amp;post=267&amp;subd=andreferraro&amp;ref=&amp;feed=1" border="0" alt="">
</div><br style="clear:both"/></div></div>
<hr class='sep-posts'/>
<div id="post-3176" class="blog-post position-5 last odd-post"><div class="odd-post-inner blog-post-inner"><h1 class="title"><a href="http://softwarelivre.org/andre-ferraro/blog/linux-checando-mantendo-e-monitorando-o-raid-raid10-no-ubuntu-intrepid-ibex-ubuntu-8.10">Linux: Checando, mantendo e monitorando o RAID (RAID10) no Ubuntu Intrepid Ibex (Ubuntu 8.10)</a></h1><span class="publishing-info"><span class="date">30 de Abril de 2009, 0:00</span><span class="author">, por Software Livre Brasil</span><span class="comments"> - <a href="/andre-ferraro/blog/linux-checando-mantendo-e-monitorando-o-raid-raid10-no-ubuntu-intrepid-ibex-ubuntu-8.10#comments_list"><span class='comment-count hide'>1</span><span class='comment-count-write-out'>Um comentário</span></a></span></span><div class="snap_preview">
<br><div class="wp-caption alignleft" style="width: 225px;">
<a href="http://andreferraro.wordpress.com/2009/04/30/linux-checando-mantendo-monitorando-raid-raid10-ubuntu-intrepid-ibex-810/ubuntu-raid-monitoramento/"><img title="RAID: Monitoramento e checagem" class="size-full wp-image-239" src="http://andreferraro.files.wordpress.com/2009/04/ubuntu-raid-monitoramento.jpg?w=215&amp;#038;h=300" height="300" alt="RAID: Monitoramento e checagem" width="215"></a><p class="wp-caption-text">RAID: Monitoramento e checagem</p>
</div>
<p>Agora que já seguimos o <em>post</em> anterior (<a href="http://andreferraro.wordpress.com/2009/04/26/linux-criando-e-configurando-o-raid-10-via-software-no-ubuntu-intrepid-ibex-ubuntu-810/" title=" Linux: Criando e configurando o RAID 10 via software no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">Linux: Criando e configurando o RAID 10 via software no Ubuntu Intrepid Ibex (Ubuntu 8.10)</a>)relativo a criação e configuração do RAID10 (RAID 1+0), então chegou a hora de testarmos e monitorarmos nosso <em>array</em>. Outro item bastante importante, que devemos conhecer, é o arquivo de configuração chamado de <strong>mdadm.conf</strong>, por isso, ainda neste <em>post</em>, vou comentar sobre como configurá-lo. Para finalizar este post, vamos criar um script de monitoramento que automaticamente enviará e-mails de falha e alimentará um <em>log </em>com as informações geradas pelo utilitário <em>mdadm</em>.<span></span></p>
<p>Começaremos checando se nosso <em>array</em> está funcionando. Os comandos abaixo servem para tal checagem:</p>
<p><code># sudo mdadm --query /dev/md0</code></p>
<p>O comando exibe informações básicas do <em>array</em>, como o tamanho total, nível, número de dispositivos e <em>spares</em> (discos de estepe).</p>
<p>O comando abaixo tem um resultado bem mais detalhado e exibe também a data de criação, o tamanho em MB de cada dispositivo, data da atualização, o status, dispositivos ativos, dispositivos em funcionamento, dispositivos que falharam, <em>layout</em> e o tamanho do <em>chunck</em>:</p>
<p><code># sudo mdadm --detail /dev/md0</code></p>
<p>O próximo comando, na verdade é a listagem de um processo, é o que considero mais importante quando estamos criando ou “montando” o <em>array</em>, pois mostra o status em tempo real do que está acontecendo em seu RAID:</p>
<p><code># cat /proc/mdstat</code></p>
<p>Para verificar o tamanho das partições, basta utilizar o comando: <em>df -Th</em>.</p>
<h3>Utilizando o arquivo mdadm.conf e demais configurações do mdadm</h3>
<p>O arquivo <strong>/etc/mdadm/mdadm.conf</strong> tem como função armazenar as informações de configuração do seu RAID e é extremamente importante para parar ou reinicializar seu <em>array</em>.</p>
<p>O utilitário <em>mdadm</em> do <em>Ubuntu Intrepid Ibex</em> (<em>Ubuntu 8.10</em>) cria automaticamente o arquivo no momento de criação do RAID, porém gosto da idéia de deixá-lo extremamente bem configurado para não correr riscos em caso de desastre. A partir de agora vamos entender como configurar este arquivo.</p>
<p>Existem oito áreas configuráveis no <em>mdadm.conf</em>, porém as principais são <strong>DEVICE</strong>, <strong>CREATE</strong> e <strong>ARRAY</strong>, mais detalhes:</p>
<p><strong>DEVICE</strong> – deve conter todas as partições adicionadas ao <em>array</em>. Para sabermos quais são, devemos saber qual é a partição referente ao <strong>RAID</strong>, então digite:</p>
<p><code># sudo df -Th</code></p>
<p>E procure por sistemas de arquivos como <em>/dev/md0</em>, depois vamos consultar as informações desse ponto de montagem com o comando:</p>
<p><code># sudo mdadm --detail /dev/md0</code></p>
<p>As últimas linhas revelarão quais são as partições, no exemplo abaixo deixei em negrito quais são as minhas partições utilizadas para montagem do <em>array</em>:</p>
<p><code>Number   Major   Minor   RaidDevice State</code><br>
<code>0       8        3        0      active sync   <strong>/dev/sda3</strong></code><br>
<code>1       8       17        1      active sync   <strong>/dev/sdb1</strong></code><br>
<code>2       8       33        2      active sync   <strong>/dev/sdc1</strong></code><br>
<code>3       8       49        3      active sync   <strong>/dev/sdd1</strong></code></p>
<p>Ou seja, devemos colocar a seguinte informação na área de <strong>DEVICES</strong> do arquivo <em>mdadm.conf</em>:</p>
<p><code>DEVICE /dev/sda3 /dev/sdb1 /dev/sdc1 /dev/sdd1</code></p>
<p><strong>CREATE</strong> – são os valores padrões utilizados quando o sistema cria o <em>array</em>. Fazem referência ao usuário proprietário pelo <em>array</em>, o grupo de usuários o padrão de permissões e se deve ser criado automaticamente. Sinceramente prefiro deixar como o <em>mdadm</em> o criou, que deve ser algo assim:</p>
<p><code>CREATE owner=root group=disk mode=0660 auto=yes</code></p>
<p><strong>HOMEHOST</strong> – não existe documentação a respeito desse comando, porém a função dele é dizer qual é o nome do servidor (<em>hostname</em>) gravado na <em>metadata</em>. Sem essa informação não será possível utilizar o RAID, portanto deixe esta opção como &lt;system&gt;.</p>
<p><strong>MAILADDR</strong> – endereço de e-mail para onde as informações de monitoramento deverão ser enviadas. Por padrão o monitoramento é ativado na inicialização do <em>mdadm</em>. Veja mais em <em>/etc/init.d/mdadm</em>.</p>
<p><strong>MAILFROM</strong> – é o endereço do remetente do e-mail enviado pelo monitoramento. Muito útil para sabermos rapidamente qual máquina enviou a mensagem. Por padrão o endereço é <em>root@nomedamaquina</em>.</p>
<p><strong>PROGRAM</strong> – caminho do <em>script</em> que intermedia o monitoramento. No final deste post coloquei um <em>script</em> para monitoramento adaptado da Novell.</p>
<p><strong>ARRAY</strong> – identifica a combinação dos discos (<em>array</em>), o nível de RAID, o número de dispositivos e por fim o <strong>UUID</strong> em formato hexadecimal. Nota o <strong>UUID</strong>, acrônico de <em>Universally Unique Identifier</em>, foi adotado no Ubuntu para facilitar a identificação de dispositivos independentemente do barramento conectado. Muito útil para dispositivos removíveis como pen-drives. Para saber qual é o <em>UUID</em> de um dispositivo, por exemplo a partição de RAID, utilize o comando <code># vol_id /dev/md0</code>.</p>
<p>Voltando… exite um comando para sabermos quais informações devemos manter na configuração <strong>ARRAY</strong>. Basta digitar o comando abaixo e adicionar o resultado ao arquivo <em>mdadm.conf</em>:</p>
<p><code># mdadm --misc --detail --brief /dev/md0 &gt;&gt; /etc/mdadm/mdadm.conf</code></p>
<p>O final do seu arquivo mdadm.conf deverá ficar como esta parte:</p>
<p><code>ARRAY /dev/md0 level=raid10 num-devices=4 metadata=00.90 UUID=7d45dd9f:9c1c3041:e368bf24:bd0fce41</code></p>
<p>Para testar se o arquivo <em>mdadm.conf</em> está correto, então você deverá ter o CD do Ubuntu Server em mãos, pois como em nosso exemplo montamos a partição <em>bin/</em> e <em>sbin/</em> dentro do <em>array</em>, então se desmontarmos a partição de RAID, não conseguiremos ter acesso aos comando para remontá-la.</p>
<p>Caso queira testar mesmo assim os comandos são:</p>
<p><code># umount /dev/md0</code><br>
<code># mdadm --misc -v --stop /dev/md0</code><br>
<code># mdadm --assemble -v --run /dev/md0</code></p>
<p><strong>Sugestão</strong>: Caso você esteja configurando um servidor de arquivos, então os detalhes dos acontecimentos com seu RAID são fundamentais, sendo assim, sugiro editar o arquivo <em>/etc/default/mdadm</em> e alterar a clausula <em>VERBOSE</em> para <em>true</em> (verdadeiro).</p>
<h4>Exemplo do arquivo de configuração mdadm.conf</h4>
<p>As configurações deste arquivo <em>mdadm.conf</em> seguem o modelo proposto pelo manual do utilitário <strong>mdadm</strong> (<em>man mdadm.conf</em>), porém, para que funcione o envio de e-mail em caso de problema, você deverá ter um serviço de envio de mensagens (<em>SMTP</em>) configurado em seu servidor. No <strong>Ubuntu 8.10</strong> (<em>Intrepid</em>) o serviço de envio de e-mails utilizado pelo <em>mdadm</em> é o <a href="http://packages.ubuntu.com/intrepid/citadel-mta" title="citadel-mta" target="_blank"><em>citadel-mta</em></a>, porém no <strong>Ubuntu 9.04</strong> (<em>Jaunty</em>) o pacote indicado para esta tarefa é o <a href="http://packages.ubuntu.com/jaunty/postfix" title="postfix" target="_blank"><em>postfix</em></a>. Você verá que no script de monitoramento eu não utilizo nenhum dos dois e sim o <a href="http://packages.ubuntu.com/intrepid/ssmtp" title="ssmtp" target="_blank"><strong>ssmtp</strong></a> por ser extremamente leve e simples de configurar. (mais informações em: <a href="http://andreferraro.wordpress.com/2009/04/30/linux-enviando-email-gmail-bash-linha-de-comando-ssmtp-ubuntu-jaunty-904/" title="Linux: Enviando e-mail do gmail pelo BASH (linha de comando) utilizando SSMTP no Ubuntu 9.04" target="_self">Linux: Enviando e-mail do gmail pelo BASH (linha de comando) utilizando SSMTP no Ubuntu 9.04</a><strong> </strong>)</p>
<p>Abaixo está o exemplo de configuração do arquivo <strong>/etc/mdadm/mdadm.conf</strong>:</p>
<p><code>DEVICE /dev/sda1 /dev/sdb1 /dev/sdc1 /dev/sdd1</code><br>
<code>CREATE owner=root group=disk mode=0660 auto=yes</code><br>
<code>HOMEHOST &lt;system&gt;</code><br>
<code>MAILADDR seu-email@seu-dominio.com</code><br>
<code>MAILFROM seu-servidor@seu-dominio.com</code><br>
<code>ARRAY /dev/md0 level=raid10 num-devices=4 UUID=c4456b47:e8cb8a5b:e368bf24:bd0fce41</code></p>
<h4>Exemplo de script de monitoramento</h4>
<p>Supondo que os arquivos <em>/etc/ssmtp/ssmtp.conf</em> e <em>/etc/ssmtp/revaliases</em> estão configurados conforme o <em>post</em> <a href="http://andreferraro.wordpress.com/2009/04/30/linux-enviando-email-gmail-bash-linha-de-comando-ssmtp-ubuntu-jaunty-904/" title="Linux: Enviando e-mail do gmail pelo BASH (linha de comando) utilizando SSMTP no Ubuntu 9.04" target="_self">Linux: Enviando e-mail do gmail pelo BASH (linha de comando) utilizando SSMTP no Ubuntu 9.04</a> (funciona no Ubuntu 8.10), então vamos direto ao <em>script</em> de monitoramento. Eu, particularmente, deixo esse <em>script</em> em <strong>/etc/mdadm/raidMonitor.sh</strong>, porém pode ser alterado.</p>
<p>Este <em>script</em> possui três funções, onde a primeira é verificar qual o problema ocorrido, ou seja, se foi uma falha, uma falha do <em>spare</em> (disco de estepe), uma queda da “qualidade” (<em>degraded</em>) da montagem do <em>array</em>, ou ainda se foi apenas um teste gerado manualmente. A segunda função é gravar um arquivo de log em /var/log/mdadm.log com a mensagem e a data e hora da ocorrência. Por fim, a terceira função é enviar um e-mail com todos os detalhes do <em>RAID</em> para sua caixa de mensagens.</p>
<p>Código do <em>script</em> de monitoramento do RAID:</p>
<p><code># variaveis recebidas pelo monitoramento</code><br>
<code>evento=$1</code><br>
<code>dispositivo=$2</code></p>
<p><code># testa o evento para gravar a mensagem correta no log</code><br>
<code>if [ $evento = "Fail" ] ; then</code><br>
<code> echo &gt;&gt; /var/log/mdadm.log</code><br>
<code> date &gt;&gt; /var/log/mdadm.log</code><br>
<code> echo " - Uma falha foi detectada no dispositivo " $dispositivo &gt;&gt; /var/log/mdadm.log</code><br>
<code>elif [ $evento = "FailSpare" ] ; then</code><br>
<code> echo &gt;&gt; /var/log/mdadm.log</code><br>
<code> date &gt;&gt; /var/log/mdadm.log</code><br>
<code> echo " - Uma falha foi detectada no spare " $dispositivo &gt;&gt; /var/log/mdadm.log</code><br>
<code>elif [ $evento = "DegradedArray" ] ; then</code><br>
<code> echo &gt;&gt; /var/log/mdadm.log</code><br>
<code> date &gt;&gt; /var/log/mdadm.log</code><br>
<code> echo " - Um degraded foi detectado no dispositivo " $dispositivo &gt;&gt; /var/log/mdadm.log</code><br>
<code>elif [ $evento = "TestMessage" ]; then</code><br>
<code> echo &gt;&gt; /var/log/mdadm.log</code><br>
<code> date &gt;&gt; /var/log/mdadm.log</code><br>
<code> echo " - Uma mensagem de teste foi gerada pelo monitoramento do dispositivo " $dispositivo &gt;&gt; /var/log/mdadm.log</code><br>
<code>fi</code></p>
<p><code># variaveis de configuracao do e-mail<br>
</code><code>EmailFrom="seu-email@gmail.com"<br>
</code><code>NomeFrom="nome do servidor"<br>
</code><code>EmailTo="seu-email@gmail.com"<br>
</code><code>Assunto="[Servidor]RAID10 - $1"<br>
</code><code>EmailPwd="sua-senha-do-gmail"</code></p>
<p><code># cria arquivo temporario que contera as informacoes no e-mail</code><br>
<code>touch /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "To: $EmailTo" &gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "From: \"$NomeFrom\" &lt;$EmailFrom&gt;" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "X-Priority: 1" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "Subject: $Assunto" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "ATENCAO! FALHA NO SERVIDOR DE ARQUIVOS." &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "Resultado do comando: mdadm --detail $dispositivo" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "------------------------------------------------------" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>mdadm --detail $dispositivo &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "------------------------------------------------------" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "Resultado do comando: cat /proc/mdstat" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "------------------------------------------------------" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>cat /proc/mdstat &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "------------------------------------------------------" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "" &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>echo "Data e hora da ocorrencia: " &gt;&gt; /etc/mdadm/msgtemp01.txt</code><br>
<code>date &gt;&gt; /etc/mdadm/msgtemp01.txt</code></p>
<p><code># envia o e-mail utilizando o ssmtp</code><br>
<code>ssmtp $EmailTo -au$EmailFrom -ap$EmailPwd &lt; /etc/mdadm/msgtemp01.txt</code></p>
<p><code># remove arquivo temporario</code><br>
<code>rm -R /etc/mdadm/msgtemp01.txt</code></p>
<p>Caso queira utilizar este <em>script</em>, então seu arquivo <strong>/etc/mdadm.conf</strong> deverá ser modificado. Comente as linhas referentes a <strong>MAILADDR</strong> e <strong>MAILFROM</strong> e insira a linha <strong>PROGRAM /etc/mdadm/raidMonitor.sh</strong>.</p>
<p>Para testar seu <strong>script de monitoramento</strong> basta digitar o comando:</p>
<p><code># mdadm --monitor --scan -test</code></p>
<p>Pronto. Seu servidor agora checado quanto ao funcionamento, está configurado através do arquivo <em>/etc/mdadm.conf</em> e por fim tem um programa de monitoramento com envio de e-mails e gravação de <em>log</em>.</p>
<p>No próximo <em>post</em> trataremos sobre solução de problemas e falhas no <strong>RAID</strong> e finalizamos o assunto <strong>RAID10 </strong>via software no <strong>Ubuntu</strong>.</p>
<h4>Veja todos os demais <em>posts </em>sobre RAID</h4>
<ul>
<li><a href="http://andreferraro.wordpress.com/2009/04/25/linux-raid-no-ubuntu-intrepid-ibex-ubuntu-810/" title="Linux: RAID no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">RAID no Ubuntu Intrepid Ibex (Ubuntu 8.10)</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/25/linux-raid-e-niveis-de-raid/" title=" Linux: RAID e níveis de RAID" target="_self">RAID e níveis de RAID</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/26/linux-criando-e-configurando-o-raid-10-via-software-no-ubuntu-intrepid-ibex-ubuntu-810/" title="Linux: Criando e configurando o RAID 10 via software no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">Criando e configurando o RAID 10 no Ubuntu 8.10</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/30/linux-checando-mantendo-monitorando-raid-raid10-ubuntu-intrepid-ibex-810/" title=" Linux: Checando, mantendo e monitorando o RAID (RAID10) no Ubuntu Intrepid Ibex (Ubuntu 8.10)" target="_self">Checando, mantendo e monitorando o RAID</a></li>
<li><a href="http://andreferraro.wordpress.com/2009/04/30/linux-corringindo-falhas-solucionando-problemas-raid-ubuntu-intrepid-810" title="Linux: Corringindo falhas e solucionando problemas de RAID no Ubuntu Intrepid (Ubuntu 8.10)" target="_self">Gerenciando catástrofes</a></li>
</ul>
Posted in Redes Tagged: 8.10, bash, configuração, configurando, howto, ibex, instalação, intrepid, linux, mdadm, mdadm.conf, monitoramento, Programação, RAID, raid 10, raid10, Redes, script, smtp, ssmtp, tutorial, ubuntu, ubuntu 8.10, ubuntu intrepid ibex <a href="http://feeds.wordpress.com/1.0/gocomments/andreferraro.wordpress.com/237/"><img src="http://feeds.wordpress.com/1.0/comments/andreferraro.wordpress.com/237/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godelicious/andreferraro.wordpress.com/237/"><img src="http://feeds.wordpress.com/1.0/delicious/andreferraro.wordpress.com/237/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/gostumble/andreferraro.wordpress.com/237/"><img src="http://feeds.wordpress.com/1.0/stumble/andreferraro.wordpress.com/237/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/godigg/andreferraro.wordpress.com/237/"><img src="http://feeds.wordpress.com/1.0/digg/andreferraro.wordpress.com/237/" border="0" alt=""></a> <a href="http://feeds.wordpress.com/1.0/goreddit/andreferraro.wordpress.com/237/"><img src="http://feeds.wordpress.com/1.0/reddit/andreferraro.wordpress.com/237/" border="0" alt=""></a> <img src="http://stats.wordpress.com/b.gif?host=andreferraro.wordpress.com&amp;blog=6980461&amp;post=237&amp;subd=andreferraro&amp;ref=&amp;feed=1" border="0" alt="">
</div><br style="clear:both"/></div></div><div class="pagination"><a class="previous_page" rel="prev" href="/andre-ferraro/blog?npage=2"><span class="previous-arrow">&laquo; </span>Anterior</a> <a rel="start" href="/andre-ferraro/blog?npage=1">1</a> <a rel="prev" href="/andre-ferraro/blog?npage=2">2</a> <em class="current">3</em> <a rel="next" href="/andre-ferraro/blog?npage=4">4</a> <a class="next_page" rel="next" href="/andre-ferraro/blog?npage=4">Próximo<span class="next-arrow"> &raquo;</span></a></div>
</div>

    <br style="clear:both" />
  </div> <!-- end class="article-body" -->








</div><!-- end id="article" -->
<link rel="stylesheet" media="screen" href="/assets/vendor/jquery.fancybox-f18bccba6b2b1108ccca4462da78aa43.css" /><script src="/assets/vendor/jquery.fancybox.pack-c84445b4cd8162f8a15703d690ccc514.js"></script><script>
//<![CDATA[
apply_zoom_to_images("Mais zoom")
//]]>
</script>
</div></div></div></div></div>
</div></div></div><div id="profile-footer"></div>
  <br style='clear: both'/>
</div><!-- end id="content-inner" -->

        </div><!-- end id="content" -->
      </div><!-- end id="wrap-2" -->
    </div><!-- end id="wrap-1" -->
    
    <div id="footer">
      <div id="theme-footer">
        <div id="footer-environment">
<div id="footer-links">
  <ul>
    <li><ul id="slbr-footer">
        <li><a href="http://softwarelivre.org" id="slbr" class="link-this-page"><span>Software Livre - Brasil</span></a></li>
        <li><a href="http://softwarelivre.org/tv"><span>TV Software Livre</span></a></li>
        <li><a href="http://softwarelivre.org/radio"><span>Rádio Software Livre</span></a></li>
        </ul></li>
    <li><ul id="conheca-footer"><h3>Conheça</h3>
        <li><a href="http://softwarelivre.org/portal/quem-somos">Quem Somos</a></li>
        <li><a href="http://softwarelivre.org/portal/termos-de-uso">Termos de Uso</a></li>
        <li><a href="http://softwarelivre.org/doc">Documentação</a></li>
        <li><a href="http://softwarelivre.org/contact/portal/new">Fale Conosco</a></li>
        </ul></li>
    <li><ul id="colabore-footer"><h3>Colabore</h3>
        <li><b><a href="http://softwarelivre.org/myprofile/portal/cms/suggest_an_article">Sugerir um Artigo</a></b></li>
        <li><a href="http://softwarelivre.org/portal/melhorias">Sugerir Melhorias</a></li>
        <li><a href="http://softwarelivre.org/portal/bugs">Reportar um Bug</a></li>
        <li><a href="http://softwarelivre.org/portal/desenvolvimento">Desenvolvimento</a></li>
        </ul></li>
    <li><ul id="compartilhe-footer"><h3>Compartilhe</h3>
        <li><b><!-- AddToAny BEGIN -->
        <a class="a2a_dd" href="http://www.addtoany.com/share_save?linkurl=http%3A%2F%2Fsoftwarelivre.org&amp;linkname=SoftwareLivre.org">Compartilhar Isto!</a>
        <script type="text/javascript">
        var a2a_config = a2a_config || {};
        a2a_config.linkname = "SoftwareLivre.org";
        a2a_config.linkurl = "http://softwarelivre.org";
        a2a_config.onclick = 1;
        a2a_config.locale = "pt-BR";
        a2a_config.num_services = 6;
        a2a_config.prioritize = ["identi_ca", "twitter", "facebook", "google_buzz", "digg", "email"]
        </script>
        <script type="text/javascript" src="http://static.addtoany.com/menu/page.js"></script>
<!-- AddToAny END --></b></li>
        <li><a href="http://softwarelivre.org/portal/eventos">Novos Eventos</a></li>
        <li><a href="http://softwarelivre.org/portal/portfolio">Portfólio Livre</a></li>
        <li><a href="http://softwarelivre.org/portal/divulgue">Páginas Amigas</a></li>
        </ul></li>
    <li><ul id="apoio-footer"><h3>Apoio</h3>
        <li> <a href="http://softwarelivre.org/portal/apoio"><img src="/portal/anuncios/apoio.png" style="width:204px"><span>Apoio</span></img></a></li>
        </ul></li>
</div><!-- end id="footer-links" -->

<div id="copyright">
  © Copyleft 2015 -<a id="link-asl" href="http://associacao.softwarelivre.org/" title="Associação SoftwareLivre.org">ASL</a> - Alguns direitos reservados, exceto quando especificado em contrário e nos conteúdos replicados de outras fontes.
  <p id="noosfero-license">Este site utiliza o software livre <a href="http://www.noosfero.org/" id="link-noosfero">Noosfero</a>, licenciado sob a licença <a href="http://www.gnu.org/licenses/agpl.html">GNU Affero General Public License</a>, versão 3 ou superior.  </p>
</div><!-- end id="copyright" -->
</div>

<script type="text/javascript">
  jQuery(function($) {
    $(".highlights-block").insertAfter("#theme-header");
    $(".action-home-index #block-695148").insertBefore("#block-666540");
    $(".action-environment_design-index #block-695148").insertBefore("#block-666540");
    $(".action-home-index #block-695454").insertAfter("#block-666540");
    $(".action-environment_design-index #block-695454").insertAfter("#block-666540");
    $("#site-title").prependTo("#top");
    $("#user").insertAfter("#site-title");
  });
</script>

      </div><!-- end id="theme-footer" -->
      <div id="global-footer">
        
      </div><!-- end id="global-footer" -->
    </div><!-- end id="footer" -->
    
    <script src="https://s7.addthis.com/js/152/addthis_widget.js"></script>
    <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
     var u = "piwik.colivre.coop.br/";
     if(!u.match(/^https?/)){
       var protocol = ("https:" == document.location.protocol ? "https" : "http");
       u = protocol + '://' + u;
     }
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', 3]);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
    g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="http://piwik.colivre.coop.br/piwik.php?idsite=3" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

  </body>
</html>
